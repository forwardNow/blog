<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2023-12-21 16:00:51
@modify date 2023-12-22 14:29:37
@desc [description]
#endregion-->


# npm 常用命令

## 1. npm install

作用：

* 安装依赖

问题：

* 通过 `npm install` 安装依赖会导致 `package-lock.json` 发生变化
* 不同人不同时间点使用 `npm install` 安装相同的包 也会产生不同的 `package-lock.json`
* 而 `package-lock.json` 又属于公共文件，多人同时更改会导致代码冲突

应用：

* 安装未在 `package.json` 声明的依赖

### 1.1. 版本

包的版本：

| 语法 | 说明 | 示例 |
| - | - | - |
| ~version | Approximately equivalent to version | `~1.2.3` == `[1.2.3, 1.3.0)` |
| ^version | Compatible with version | `^1.2.3` == `[1.2.3, 2.0.0)` |
| version | Must match version exactly | `1.2.3` |
| >version | Must be greater than version | `>1.2.3` == `(1.2.3, ∞)` |
| >=version | greater than or equal to | `>=1.2.3` == `[1.2.3, ∞)` |
| <version | - | `<1.2.3` == `[0.0.0, 1.2.3)` |
| <=version | - | `<=1.2.3` == `[0.0.0, 1.2.3]` |
| x | - | `1.2.x` == `[1.2.0, 1.3.0)` |
| * | Matches any version | `*` == `[0.0.0, ∞)` |
| latest | Obtains latest release | `latest` |

### 1.2. --registry

说明：

* 安装时指定仓库

示例：

```shell
npm i express --registry=https://registry.npm.taobao.org
```

## 2. npm ci

作用：

* 基于 `package-lock.json` 安装依赖

应用：

* 安装已在 `package.json` 声明的依赖
* 也就是说，别人安装了新依赖，你拉取了 `package.json` 和 `package-lock.json` 后，使用 `npm ci` 安装依赖

参考：

* [npm-ci —— NPM Docs](https://docs.npmjs.com/cli/v8/commands/npm-ci)

## 3. npm link

作用：

* 将模块安装到全局 node_modules 中
* 将（全局的）模块安装当前项目中

示例：

* 全局安装

    ```shell
    cd
    #=> D:\dev\my-module

    # 在全局 node_modules 中创建符号链接（D:\dev\my-module）
    npm link

    # 查看全局安装的位置
    npm root -g
    #=> C:\Program Files\nodejs\node_modules

    # 删除
    npm uni -g my-module
    ```

* 项目安装（先要全局安装）

    ```shell
    cd
    #=> D:\project\my-proj

    npm link my-module

    # 在当前项目的 node_modules 中创建符号链接（D:\dev\my-module）
    ```

参考：

* [npm模块管理器 - 来自《JavaScript 标准参考教程（alpha）》，by 阮一峰](https://javascript.ruanyifeng.com/nodejs/npm.html#toc18)

## 4. package.json 中的 bin 属性

作用：

* 创建（命令行）命令

示例：（package.json）

* 定义 hui 命令

  ```json
  {
    "bin": {
      "hui": "./src/index.js"
    }
  }
  ```

* `./src/index.js`

  ```javascript
  #!/usr/bin/env node

  console.log('hehe');
  ```

* 执行

  ```shell
  # 本地安装
  ./node_modules/.bin/hui

  # 全局安装
  hui
  ```

## 5. npm view 查看包的所有版本

```shell
npm view less-loader versions 
# [
#   '0.1.0',  '0.1.1',  '0.1.2',  '0.1.3',  '0.2.0',
#   '0.2.1',  '0.2.2',  '0.5.0',  '0.5.1',  '0.6.0',
#   '0.6.1',  '0.6.2',  '0.7.0',  '0.7.1',  '0.7.2',
#   '0.7.3',  '0.7.4',  '0.7.5',  '0.7.6',  '0.7.7',
#   '0.7.8',  '2.0.0',  '2.1.0',  '2.2.0',  '2.2.1',
#   '2.2.2',  '2.2.3',  '3.0.0',  '4.0.0',  '4.0.1',
#   '4.0.2',  '4.0.3',  '4.0.4',  '4.0.5',  '4.0.6',
#   '4.1.0',  '5.0.0',  '6.0.0',  '6.1.0',  '6.1.1',
#   '6.1.2',  '6.1.3',  '6.2.0',  '7.0.0',  '7.0.1',
#   '7.0.2',  '7.1.0',  '7.2.0',  '7.2.1',  '7.3.0',
#   '8.0.0',  '8.1.0',  '8.1.1',  '9.0.0',  '9.1.0',
#   '10.0.0', '10.0.1', '10.1.0', '10.2.0', '11.0.0',
#   '11.1.0'
# ]
```

## 6. npm pack

说明：

* 将项目打包成 npm 包，创建一个 tarball（.tgz 文件）—— `my-project-x.y.z.tgz`
* 别人可以通过 `npm i my-project-x.y.z.tgz` 安装

语法：

```text
npm pack --pack-destination dist-zip

  --pack-destination dist-zip : 指定 tarball 的存放的位置，注意 dist-zip 目录要存在
```

示例：

* 目录：

    ```text
    D:/
      flowchart-editor/
      proj/
    ```

* 命令:

    ```shell
    cd flowchart-editor

    npm pack --pack-destination dist-zip


    copy dist-zip/flowchart-editor-1.0.3.tgz ../proj/libs

    cd ../proj

    npm i ./libs/flowchart-editor-1.0.3.tgz

    npm uni flowchart-editor
    ```

参考：

* [npm pack 作用 —— 稀土掘金 ](https://juejin.cn/s/npm%20pack%20%E4%BD%9C%E7%94%A8)