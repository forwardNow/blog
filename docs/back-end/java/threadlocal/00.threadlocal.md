<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2025-11-22 16:07:23
@modify date 2025-11-22 16:29:59
@desc [description]
#endregion-->

# threadlocal

## 1. ThreadLocal 介绍

### 1.1. 官网介绍

从 Java 官方文档中的描述: ThreadLocal 类用来提供线程内部的局部变量。这种变量在多线程环境下访问（通过 get/set 方法访问）时能保证各个线程的变量相对独立于其它线程内的变量。ThreadLocal 实例通常来说都是 private static 类型的，用于关联线程和线程上下文。

我们可以得知 ThreadLocal 的作用是: 提供线程内的局部变量，不同的线程之间不会互相干扰，这种变量在线程的生命周期内起作用，减少同一个线程内多个函数或组件之间一些公共变量传递的复杂度。

总结:

1. 线程并发
   * 在多线程并发的场景下
2. 传递数据
   * 通过 ThreadLocal 在同一线程、不同组件中传递公共变量
3. 线程隔离
   * 每个线程的变量都是独立的，不会互相影响

### 1.2. 基本使用

#### 1.2.1. 常用方法

| 方法声明 | 描述 |
| - | - |
| ThreadLocal() | 创建 ThreadLocal 对象 |
| public void set(T value) | 设置 当前线程绑定的局部变量 |
| public T get() | 获取 当前线程绑定的局部变量 |
| public void remove() | 移除 当前线程绑定的局部变量 |

#### 1.2.2. 使用案例

多线程 读写共享变量 出问题:

```java
public class MyDemo01 {
    private String content;

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    public static void main(String[] args) {
        MyDemo01 instance = new MyDemo01();

        for (int i = 0; i < 5; i++) {
            Thread thread = new Thread(() -> {
                String currentThreadName = Thread.currentThread().getName();

                // 给 content 属性设置值
                instance.setContent(currentThreadName + "的数据");

                // 打印 content 属性的值
                System.out.println(currentThreadName + " => " + instance.getContent());
            });

            thread.setName("线程" + i);
            thread.start();
        }

        /* =>
        线程3 => 线程3的数据
        线程0 => 线程1的数据
        线程4 => 线程1的数据
        线程2 => 线程1的数据
        线程1 => 线程1的数据
         */
    }
}
```

使用 ThreadLocal 解决上述问题:

```java
public class MyDemo02 {
    private final ThreadLocal<String> threadLocal = new ThreadLocal<>();

    public String getContent() {
        return threadLocal.get();
    }

    public void setContent(String content) {
        threadLocal.set(content);
    }

    public static void main(String[] args) {
        MyDemo02 instance = new MyDemo02();

        for (int i = 0; i < 5; i++) {
            Thread thread = new Thread(() -> {
                String currentThreadName = Thread.currentThread().getName();

                // 给 content 属性设置值
                instance.setContent(currentThreadName + "的数据");

                // 打印 content 属性的值
                System.out.println(currentThreadName + " => " + instance.getContent());
            });

            thread.setName("线程" + i);
            thread.start();
        }
    }
}
```


### ThreadLocal 类 与 synchronized 关键字

#### synchronized 同步方法

#### ThreadLocal 与 synchronized 的区别