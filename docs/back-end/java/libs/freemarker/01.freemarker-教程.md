<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2026-01-07 21:07:27
@modify date 2026-01-09 19:17:17
@desc [description]
#endregion-->

# FreeMarker - 教程

## 1. 概述

FreeMarker:

* 一款模板引擎，一个 Java 类库
* 一种基于 模板和要改变的数据，并用来生成文本的通用工具。
* 文档: http://freemarker.foofun.cn/

技术选型对比:

| 技术 | 说明 |
| - | - |
| Jsp | Jsp 为 Servlet 专用，不能单独进行使用 |
| Velocity | Velocity 从 2010 年更新完 2.0 版本后，7 年没有更新。Spring Boot 官方在 1.4 版本后对此也不再支持 |
| thmeleaf | 新技术，功能较为强大，但是执行的效率比较低 |
| freemarker | 性能好，强大的模板语言、轻量 |

## 2. 快速开始

### 2.1. 环境搭建

依赖: (springboot 项目)

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-freemarker</artifactId>
</dependency>
<!-- 操作文件 -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-io</artifactId>
    <version>1.3.2</version>
</dependency>
```

配置:

```yml
server:
  port: 80
spring:
  application:
    # 应用名称
    name: test-freemarker
  freemarker:
    # 关闭模板缓存，方便调试
    cache: false
    # 模板文件的后缀名 (默认 .ftlh)
    suffix: .ftl
    settings:
      # 模板更新的延迟时间，为 0 则没有延迟
      template_update_delay: 0
```

注意:

* freemarker 模板文件的扩展名通常是 `ftl`，也可以是 `html`、`xml`、`jsp` 等
* 模板文件默认存放在 `resources/templates`

### 2.2. 入门案例

controller:

```java
@Controller
public class FreeMarkerController {
    @GetMapping("/01-basic")
    public String basic(Model model) {
        model.addAttribute("name", "张三");
        model.addAttribute("stu", Student.of("李四", 18, new Date(), 123.3f));
        return "01-basic";
    }
}
```

bean:

```java
@Data
@AllArgsConstructor(staticName = "of")
public class Student {
    private String name;
    private int age;
    private Date birthday;
    private Float money;
}
```

templates/01-basic.ftl:

```html
<#-- 插值表达式 -->

<p>普通文本 String 展示:</p>
<ul>
  <li>name: ${ name }</li>
</ul>

<hr>

<p>Student 对象的属性展示: </p>
<ul>
  <li>stu.name : ${stu.name}</li>
  <li>stu.age : ${stu.age}</li>
</ul>
```

## 3. 指令语法

基础语法种类

集合指令（List 和 Map）

if 指令

运算符

空值处理

内建函数

### 3.1. 基础语法种类

注释:

```html
<#-- 注释内容， 会被湖绿 -->
```

插值(表达式):

```html
hello ${ name }
```

FTL 指令:

```html
<#指令名称></#指令名称>
```

文本:

```html
<#-- 模板中的普通文本，会直接输出 -->
文本内容
```

### 3.2. 集合指令

#### 3.2.1. List

格式:

```html
<#list 列表名 as 条目名>
  列表索引: ${ 条目名_index }
  元素的值: ${ 条目名 }
</#list>
```

示例:

```java
@GetMapping("/02-list")
public String list(Model model) {
    List<Student> studentList = new ArrayList<>();
    studentList.add(Student.of("张三", 18, new Date(2000, 1, 2), 123.3f));
    studentList.add(Student.of("李四", 23, new Date(2002, 10, 28), 456.7f));

    model.addAttribute("studentList", studentList);

    return "02-list";
}
```

```html
<table>
  <tr>
    <th>序号</th>
    <th>姓名</th>
    <th>年龄</th>
    <th>存款</th>
  </tr>
  <#list studentList as item>
    <tr>
      <th>${ item_index + 1 }</th>
      <th>${ item.name }</th>
      <th>${ item.age }</th>
      <th>${ item.money }</th>
    </tr>
  </#list>
</table>
```

#### 3.2.2. Map

语法:

```html
${MAP.属性名}

${MAP["属性名"]}

<#list MAP?keys as 键名变量>
  <p>
    索引: ${键名变量_index}  <br>
    属性: ${ MAP[键名变量].属性名 }
  </p>
</#list>
```

示例:

```java
@GetMapping("/03-map")
public String map(Model model) {
    Map<String, Object> studentMap = new HashMap<>();

    studentMap.put("stu1", Student.of("王五", 28, new Date(2004, 1, 9), 166.7f));
    studentMap.put("stu2", Student.of("赵六", 32, new Date(2006, 2, 8), 887.7f));

    model.addAttribute("studentMap", studentMap);

    return "03-map";
}
```

```html
<#-- 通过 .  读 map 中的属性 -->
<p>姓名: ${studentMap.stu1.name}</p>

<#-- 通过 [] 读 map 中的属性 -->
<p>年龄: ${studentMap["stu1"].age}</p>

<#-- 遍历 map -->
<#list studentMap?keys as stuMapKey>
  <p>
    索引: ${ stuMapKey_index }  <br>
    姓名: ${ studentMap[stuMapKey].name }
  </p>
</#list>
```

### 3.3. if 指令

语法:

```html
<#if condition>
  ...
<#elseif condition2>
  ...
<#elseif condition3>
  ...
<#else>
  ...
</#if>
```

示例:

```html
<#--
  相等比较: 使用 “=” 或 “==” 都可以
  字符串字面量: 使用 单引号或双引号 界定
-->
<#if student.name = "张三">
    <span style="color: red">${ student.name }</span>
<#else>
    <span style="color: blue">${ student.name }</span>
</#if>
```

### 3.4. 运算符

算数运算符: 

* 加: `+`
* 减: `-`
* 乘: `*`
* 除: `/`
* 取模: `%`

比较运算符:

* 相等: `=` 或者 `==`
* 不相等: `!=`
* 大于: `>` 或者 `gt`
* 大于或等于: `>=` 或者 `gte`
* 小于: `<` 或者 `lt`
* 小于或等于: `<=` 或者 `lte`

注意:

* `==` 、`!=` 可以用于 字符串、数字、日期 的比较
* `==` 、`!=` 两边必须是相同类型，否则会报错
* 字符串比较是大小写敏感的
* 使用 `gt` 替代 `>`，FreeMarker 会将 `>` 解析成标签的结束字符
   * 可以使用小括号包裹: `<#if (2 > 1)>`

逻辑运算符:

* 与: `&&`
* 或: `||`
* 非: `!`

### 3.5. 空值处理

判断 变量 是否存在:

```html
<#-- wahh 变量不存在 -->
<#if wahh??>
    wahh 变量 存在
<#else>
    wahh 变量 不存在
</#if>

<br>

<#-- user 变量 为 null -->
<#if user??>
    user 变量 不为 null
<#else>
    user 变量 为 null
</#if>
```

默认值:

```html
<#-- 不存在的变量 -->
<p> ${ wahh ! "wahh 不存在！！！" } </p>

<#-- 为 null 的变量 -->
<p> ${ user ! "user 为 null！！！" } </p>

<#-- 嵌套 取值 -->
<p> ${ (user.address.city) ! "user.address.city 更为 null ！！！" } </p>
```


## 4. 参考

* [项目实战微服务项目《黑马头条》 - FreeMarker](https://www.bilibili.com/video/BV1Qs4y1v7x4?vd_source=980e7e42545c81c2b6f1445ce8f16d28&spm_id_from=333.788.videopod.episodes&p=26)
* [【FreeMarker】一文快速入门 FreeMarker](https://blog.csdn.net/weixin_45683778/article/details/143183244)