<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2025-07-28 15:39:52
@modify date 2025-09-24 17:50:30
@desc [description]
#endregion-->

# Java 常用代码片段

## 1. JSON

### 1.1. JSON字符串 转 对象列表

```java
ObjectMapper mapper = new ObjectMapper();

String userListStr = "[ { \"name\": \"张三\", \"age\": 18 } ]";

List<User> userList = mapper.readValue(
  userListStr, 
  mapper.getTypeFactory().constructCollectionType(List.class, User.class)
);

class User {
  private String name;
  private Integer age;
}
```

## 2. 类型

### 2.1. 判断字符串是不是日期

```java
String dateString = "2023-04-01";
DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd");
// 转化失败会抛异常
LocalDate date = LocalDate.parse(dateString, formatter);
System.out.println(date);


String dateTimeString = "2023-04-01T15:30:00";
// 使用 单引号 包裹特殊字符
DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd'T'HH:mm:ss");
LocalDateTime dateTime = LocalDateTime.parse(dateTimeString, formatter);
System.out.println(dateTime);
```

### 2.2. 字符串 转 数字

```java
import org.apache.commons.lang3.math.NumberUtils;

private static Double objectToDouble(Object obj) {
    if (obj == null) {
        return null;
    }

    String valueStr = obj.toString();

    if (!NumberUtils.isCreatable(valueStr)) {
        return null;
    }

    double value = NumberUtils.toDouble(valueStr);

    return value;
}
```

## 3. 字节数组与流

字符串 转 字节数组:

```java
String content = "MinIO, 你好！";

byte[] bytes = content.getBytes(StandardCharsets.UTF_8);
ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes);
```

InputStream 转 byteArray:

```java
byte[] byteArray = IOUtils.toByteArray(byteArrayInputStream);

String content = new String(byteArray, StandardCharsets.UTF_8);
```

byteArray 转 InputStream:

```java
ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes);
```


## 4. 定时任务

### 4.1. 在 SpringBoot 中使用定时任务

步骤1: 在引导类上添加 `@EnableScheduling` 注解

```java
@SpringBootApplication
@EnableScheduling
public class LabWindApplication extends SpringBootServletInitializer { /* ... */ }
```

步骤2: 在 bean 的方法上添加 `@Scheduled(cron = "0 0/1 * * * ? ")`

```java
@Service
public class BookServiceImpl implements BookService {
  // 该方法是 public
  @Scheduled(cron = "0 0/1 * * * ? ") // 每分钟执行一次
  public void setInterval() {
    System.out.println("run ...");
  }

  @Scheduled(‌fixedRate‌ = 1000) // 每分钟执行一次
  @Scheduled(‌fixedRate‌ = 1, timeUnit = TimeUnit.MINUTES) // 每分钟执行一次
}
```

`@Scheduled` 的参数:

* cron‌: 基于 cron 表达式定义执行周期，参考 [Cron在线表达式生成器](https://cron.ciding.cc/)
* fixedDelay‌: 任务执行结束后间隔固定时间再次执行（毫秒）
* ‌fixedRate‌: 任务间隔固定时间执行（毫秒），若当前任务未完成，后续执行将等待当前任务完成
* timeUnit: 时间单位。TimeUnit.MILLISECONDS (默认) | TimeUnit.MINUTES | ...

注意:

* 该任务需要等待 SpringBook 完全启动后，（有些项目要好几分钟才会开始执行）才会执行定时任务。

## 5. 资源目录

### 5.1. 获取 resource 目录下的资源

```java
import org.apache.shiro.io.ResourceUtils;

InputStream inputStream = ResourceUtils.getInputStreamForPath("classpath:application.yml");
```

## 6. 字符串

### 6.1. 字符串模板

```java
import java.text.MessageFormat;
 
String name = "张三";
int age = 18;

String pattern = "我是 {0}，今年 {1} 岁";
String result = MessageFormat.format(pattern, name, age);

System.out.println(result); //=> "我是 张三，今年 18 岁"
```

