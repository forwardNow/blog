<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2025-08-01 20:46:46
@modify date 2025-08-01 21:52:14
@desc [description]
#endregion-->

# ssm - Maven 高级

## 1. 分模块开发

目录:

```text
01-maven-app/
  src/main/java/org/example/App.java
  pom.xml

02-maven-app-user/
  src/main/java/org/example/domain/User.java
  pom.xml
```

步骤

(1) 安装 02-maven-app-user 到本地仓库

(2) 01-maven-app 的 pom.xml 声明 02-maven-app-user 的坐标

(3) 在 App.java 直接使用 User.java

## 2. 依赖管理

一个项目可以设置多个依赖，格式为:

```xml
<!--设置当前项目所依赖的所有jar-->
<dependencies>
    <!--设置具体的依赖-->
    <dependency>
        <!--依赖所属群组id-->
        <groupId>org.springframework</groupId>
        <!--依赖所属项目id-->
        <artifactId>spring-webmvc</artifactId>
        <!--依赖版本号-->
        <version>5.2.10.RELEASE</version>
    </dependency>
</dependencies>
```

### 2.1. 依赖传递与冲突问题

![image-20250801211421752](./images/image-20250801211421752.png)

说明:

* A 代表自己的项目；
* B,C,D,E,F,G 代表的是项目所依赖的 jar 包；
* D1和D2 E1和E2 代表是相同 jar 包的不同版本

(1) A 依赖了 B 和 C, B 和 C 又分别依赖了其他 jar 包，所以在 A 项目中就可以使用上面所有 jar 包，这就是所说的依赖传递

(2) 依赖传递有直接依赖和间接依赖

* 相对于 A 来说，A 直接依赖 B 和 C,间接依赖了 D1, E1, G，F, D2 和 E2
* 相对于 B 来说，B 直接依赖了 D1 和 E1, 间接依赖了 G
* 直接依赖和间接依赖是一个相对的概念

(3) 因为有依赖传递的存在，就会导致 jar 包在依赖的过程中出现冲突问题，具体什么是冲突? Maven 是如何解决冲突的?

这里所说的 依赖冲突 是指项目依赖的某一个 jar 包，有多个不同的版本，因而造成类包版本冲突。


特殊优先：当同级配置了相同资源的不同版本，后配置的覆盖先配置的。

路径优先：当依赖中出现相同的资源时，层级越深，优先级越低，层级越浅，优先级越高
* A 通过 B 间接依赖到 E1
* A 通过 C 间接依赖到 E2
* A 就会间接依赖到 E1 和 E2, Maven 会按照层级来选择，E1 是 2 度，E2 是 3 度，所以最终会选择 E1

声明优先：当资源在相同层级被依赖时，配置顺序靠前的覆盖配置顺序靠后的
* A 通过 B 间接依赖到 D1
* A 通过 C 间接依赖到 D2
* D1 和 D2 都是两度，这个时候就不能按照层级来选择，需要按照声明来，谁先声明用谁，也就是说 B 在 C 之前声明，这个时候使用的是 D1，反之则为 D2

但是对应上面这些结果，大家不需要刻意去记它。因为不管 Maven 怎么选，最终的结果都会在 Maven 的 `Dependencies` 面板中展示出来，展示的是哪个版本，也就是说它选择的就是哪个版本

### 2.2. 可选依赖和排除依赖

可选依赖指对外隐藏当前所依赖的资源 --- 不透明

```xml
<dependency>
    <groupId>com.itheima</groupId>
    <artifactId>maven_03_pojo</artifactId>
    <version>1.0-SNAPSHOT</version>
    <!--可选依赖是隐藏当前工程所依赖的资源，隐藏后对应资源将不具有依赖传递-->
    <optional>true</optional>
</dependency>
```

排除依赖指主动断开依赖的资源，被排除的资源无需指定版本 --- 不需要

```xml
<dependency>
    <groupId>com.itheima</groupId>
    <artifactId>maven_04_dao</artifactId>
    <version>1.0-SNAPSHOT</version>
    <!--排除依赖是隐藏当前资源对应的依赖关系-->
    <exclusions>
        <exclusion>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
        </exclusion>
        <exclusion>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```

## 3. 聚合和继承

### 3.1. 聚合

聚合: 将多个模块组织成一个整体，同时进行项目构建的过程称为聚合

聚合工程：

* 通常是一个不具有业务功能的"空"工程（有且仅有一个 pom 文件）
* 聚合工程主要是用来管理项目
* 聚合工程管理的项目在进行运行的时候，会按照项目与项目之间的依赖关系来自动决定执行的顺序和配置的顺序无关。

作用：

* 使用聚合工程可以将多个工程编组，通过对聚合工程进行构建，实现对所包含的模块进行同步构建
* 当 聚合工程 的`compile`被点击后，所有被其管理的项目都会被执行编译操作。

当工程中某个模块发生更新（变更）时，必须保障工程中与已更新模块关联的模块同步更新，此时可以使用聚合工程来解决批量模块同步构建的问题。

创建聚合工程的步骤：

(1) 创建一个空的 maven 项目


(2) 将项目的打包方式改为 pom

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>org.example</groupId>
    <artifactId>system-manage</artifactId>
    <version>1.0-RELEASE</version>
    <packaging>pom</packaging>
    
</project>
```

项目的打包方式，我们接触到的有三种，分别是

* jar: 默认情况，说明该项目为 java 项目
* war: 说明该项目为 web 项目
* pom: 说明该项目为聚合或继承项目


(3) pom.xml 添加所要管理的项目

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>org.example</groupId>
    <artifactId>system-manage</artifactId>
    <version>1.0-RELEASE</version>
    <packaging>pom</packaging>
    
    <!--设置管理的模块名称-->
    <modules>
        <module>../system-manage-user</module>
        <module>../system-manage-role</module>
        <module>../system-manage-dept</module>
    </modules>
</project>
```