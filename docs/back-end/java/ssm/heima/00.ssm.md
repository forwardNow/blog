<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2025-07-09 21:21:12
@modify date 2025-07-21 22:04:51
@desc [description]
#endregion-->

# SSM

## 1. spring

### 1.1. 核心概念

(1) 什么IOC/DI思想?

IOC : 控制反转，控制反转的是对象的创建权

DI : 依赖注入，绑定对象与对象之间的依赖关系


(2) 什么是 IOC 容器?

Spring 创建了一个容器用来存放所创建的对象，这个容器就叫 IOC 容器


(3) 什么是 Bean?

容器中所存放的一个个对象就叫 Bean 或 Bean对象

### 1.2. 入门案例

目录:

```text
${root}
  src/main
      java/
          org/example
              App.java
              BookDao.java
              BookDaoImpl.java
              BookService.java
              BookServiceImpl.java
      resources/
          applicationContext.xml
          
  pom.xml
```

pom.xml:

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.2.10.RELEASE</version>
    </dependency>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.12</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

resources/applicationContext.xml:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="bookDao" class="org.example.BookDaoImpl"/>

    <bean id="bookService" class="org.example.BookServiceImpl">
        <property name="bookDao" ref="bookDao"/>
    </bean>

</beans>
```

class:

```java
public class App {
    public static void main(String[] args) {
        ApplicationContext ctx = new ClassPathXmlApplicationContext("applicationContext.xml");

        BookService bookService = (BookService) ctx.getBean("bookService");
        bookService.save();
    }
}

public interface BookDao {
    public void save();
}
public class BookDaoImpl implements BookDao {
    public void save() {
      System.out.println("book dao save ...");
    }
}

public interface BookService {
    public void save();
}
public class BookServiceImpl implements BookService {
    private BookDao bookDao;

    public void setBookDao(BookDao bookDao) {
        this.bookDao = bookDao;
    }

    public void save() {
        System.out.println("book service save ...");
        bookDao.save();
    }

}
```

### 1.3. IOC 相关

#### 1.3.1. bean 基础配置

```xml
<!-- 
  id: 必须唯一
  class: 指定实现类的全名，不可以写接口
  name: 指定别名，可定义多个，分隔符: 空格、分号、空格
  scope: "singleton" (单例，默认) | "prototype" (非单例)
 -->
<bean 
  id="bookDao"
  class="org.example.quickstart.BookDaoImpl"

  name="bookDao1, bookDao2"

  scope="singleton"
/>
```

#### 1.3.2. bean 实例化

(1) 方式一: （无参）构造函数 实例化 bean

类:

```java
// 实现类
public class BookDaoImpl implements BookDao {
    public void save() {
        System.out.println("book dao save ...");
    }
}
```

配置:

```xml
<bean id="bookDao" class="org.example.BookDaoImpl"/>
```

使用:

```java
BookDao bookDao = (BookDao) ctx.getBean("bookDao");
bookDao.save();
```


(2) 方式二: 静态工厂 实例化 bean

类:

```java
// 静态工厂类
public class OrderDaoFactory {
    public static OrderDao getOrderDao(){
        return new OrderDaoImpl();
    }
}

// 实现类
public class OrderDaoImpl implements OrderDao {
    public void save() {
        System.out.println("order dao save ...");
    }
}
```

配置:

```xml
<bean id="orderDao" class="org.example.OrderDaoFactory" factory-method="getOrderDao" />
```

使用:

```java
OrderDao orderDao = (OrderDao) ctx.getBean("orderDao");
orderDao.save();
```


(3) 方式三: 实例工厂 实例化 bean

类:

```java
// 实例工厂类
public class UserDaoFactory {
    public UserDao getUserDao(){
        return new UserDaoImpl();
    }
}

// 实现类
public class UserDaoImpl implements UserDao {
    public void save() {
        System.out.println("user dao save ...");
    }
}
```

配置:

```xml
<bean id="userFactory" class="org.example.UserDaoFactory"/>
<bean id="userDao" factory-method="getUserDao" factory-bean="userFactory"/>
```

使用:

```java
UserDao userDao = (UserDao) ctx.getBean("userDao");
userDao.save();
```


(4) 方式四: FactoryBean 实例化 bean

类:

```java
// 工厂类
public class UserDaoFactoryBean implements FactoryBean<UserDao> {
    @Override
    public UserDao getObject() throws Exception {
        return new UserDaoImpl(); // 返回 bean
    }

    @Override
    public Class<?> getObjectType() {
        return UserDao.class; // 指定 bean 的类型
    }
}
```

配置:

```xml
<bean id="userDao2" class="org.example.UserDaoFactoryBean" />
```

使用:

```java
UserDao userDao = (UserDao) ctx.getBean("userDao2");
userDao.save();
```

#### 1.3.3. bean 的生命周期

(1) 关于 Spring 中对 bean 生命周期控制提供了两种方式:

* 在配置文件中的 bean 标签中添加 `init-method` 和 `destroy-method` 属性
* 类实现 `InitializingBean` 与 `DisposableBean` 接口

```xml
<bean id="bookDao" class="org.example.BookDaoImpl" init-method="init" destroy-method="destroy" />

<bean id="userDao" class="org.example.UserDaoImpl"/>
```

```java
public class App {
    public static void main(String[] args) {
        ConfigurableApplicationContext ctx = new ClassPathXmlApplicationContext("applicationContext.xml");

        BookDaoImpl bookDao = (BookDaoImpl) ctx.getBean("bookDao");
        bookDao.save();
        UserDaoImpl userDao = (UserDaoImpl) ctx.getBean("userDao");
        userDao.save();

        // ctx.close();
        ctx.registerShutdownHook();
    }
}

public class BookDaoImpl {
    public void save() {
        System.out.println("book dao save ...");
    }

    public void init() {
        System.out.println("book dao init ...");
    }
    public void destroy() {
        System.out.println("book dao destroy ...");
    }
}

public class UserDaoImpl implements InitializingBean, DisposableBean {
    public void save() {
        System.out.println("user dao save ...");
    }

    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println("user dao init ...");
    }
    @Override
    public void destroy() throws Exception {
        System.out.println("user dao destroy ...");
    }

}
```

(2) 对于 bean 的生命周期控制在 bean 的整个生命周期中所处的位置如下:

1. 初始化容器:
  1. 创建对象(内存分配)
  2. 执行构造方法
  3. 执行属性注入(set操作)
  4. 执行bean初始化方法

2. 使用 bean
  * 执行业务操作

3. 关闭/销毁容器
  * 执行 bean 销毁方法


(3) 关闭容器的两种方式:

* ConfigurableApplicationContext 是 ApplicationContext 的子类
* close() 方法
* registerShutdownHook() 方法

### 1.4. DI 相关内容

#### 1.4.1. setter 注入

```xml
<bean id="bookDao" class="org.example.BookDaoImpl" />

<bean id="bookService" class="org.example.BookServiceImpl">
    <!-- 注入 引用类型 -->
    <property name="bookDao" ref="bookDao" />

    <!-- 注入 简单类型 -->
    <property name="name" value="ZhangSan" />
    <property name="num" value="18" />
</bean>
```

```java
public class BookServiceImpl {
    private BookDaoImpl bookDao;
    private String name;
    private int num;

    public void setBookDao(BookDaoImpl bookDao) {
        this.bookDao = bookDao;
    }
    public void setName(String name) {
        this.name = name;
    }
    public void setNum(int num) {
        this.num = num;
    }

    public void save() {
        bookDao.save();
        System.out.println("book service save ... name=" + name + ", num=" + num);
    }
}
```

#### 1.4.2. 构造器注入

```xml
<bean id="bookDao" class="org.example.BookDaoImpl" />

<bean id="bookService" class="org.example.BookServiceImpl">
    <!-- name 为形参的名称 -->
    <constructor-arg name="bookDao" ref="bookDao" />
    <constructor-arg name="name" value="ZhangSan" />
    <constructor-arg name="num" value="20" />
</bean>

```

```java
public class BookServiceImpl {
    private BookDaoImpl bookDao;
    private String name;
    private int num;

    public BookServiceImpl(BookDaoImpl bookDao, String name, int num) {
        this.bookDao = bookDao;
        this.name = name;
        this.num = num;
    }

    public void save() {
        bookDao.save();
        System.out.println("book service save ... name=" + name + ", num=" + num);
    }
}
```

介绍完两种参数的注入方式，具体我们该如何选择呢?

1. 强制依赖使用构造器进行，使用 setter 注入有概率不进行注入导致 null 对象出现
   * 强制依赖指对象在创建的过程中必须要注入指定的参数
2. 可选依赖使用 setter 注入进行，灵活性强
   * 可选依赖指对象在创建过程中注入的参数可有可无
3. Spring 框架倡导使用构造器，第三方框架内部大多数采用构造器注入的形式进行数据初始化，相对严谨
4. 如果有必要可以两者同时使用，使用构造器注入完成强制依赖的注入，使用 setter 注入完成可选依赖的注入
5. 实际开发过程中还要根据实际情况分析，如果受控对象没有提供 setter 方法就必须使用构造器注入
6. 自己开发的模块推荐使用 setter 注入

#### 1.4.3. 自动配置

说明:

* IoC 容器根据 bean 所依赖的资源在容器中自动查找并注入到 bean 中的过程称为自动装配
* 针对引用类型自动装配


自动装配方式:

* 按类型（常用）
* 按名称

示例:

```xml
<bean class="org.example.BookDaoImpl" />

<bean id="bookService" class="org.example.BookServiceImpl" autowire="byType" />
```

```java
public class BookServiceImpl implements BookService {
    private BookDao bookDao;

    public void setBookDao(BookDao bookDao) {
        this.bookDao = bookDao;
    }

    @Override
    public void save() {
        System.out.println("book service save ...");
        bookDao.save();
    }
}
```

注意事项:

* 需要注入属性的类中对应属性的 setter 方法不能省略
* 被注入的对象必须要被 Spring 的 IO 容器管理
* 按照类型在 Spring 的 IOC 容器中如果找到多个对象，会报 NoUniqueBeanDefinitionException

#### 1.4.4. 集合注入

集合类型:

* Array
* List
* Set
* Map
* Properties

示例:

```java
public class BookDaoImpl implements BookDao {
    private int[] array;
    private List<String> list;
    private Set<String> set;
    private Map<String,String> map;
    private Properties properties;

    public void setArray(int[] array) {
        this.array = array;
    }
    public void setList(List<String> list) {
        this.list = list;
    }
    public void setSet(Set<String> set) {
        this.set = set;
    }
    public void setMap(Map<String, String> map) {
        this.map = map;
    }
    public void setProperties(Properties properties) {
        this.properties = properties;
    }

    public void save() {
      System.out.println("book dao save ...");

      System.out.println("遍历数组:" + Arrays.toString(array));
      System.out.println("遍历List" + list);
      System.out.println("遍历Set" + set);
      System.out.println("遍历Map" + map);
      System.out.println("遍历Properties" + properties);
    }
}
```

```xml
<bean id="bookDao" class="org.example.BookDaoImpl">
    <property name="array">
        <array>
            <value>1</value>
            <value>2</value>
        </array>
    </property>
    <property name="list">
        <list>
            <value>ZhangSan</value>
            <value>LiSi</value>
        </list>
    </property>
    <property name="set">
        <set>
            <value>数学</value>
            <value>语文</value>
        </set>
    </property>
    <property name="map">
        <map>
            <entry key="code" value="0"/>
            <entry key="message" value="success"/>
        </map>
    </property>
    <property name="properties">
        <props>
            <prop key="name">张三</prop>
            <prop key="age">18</prop>
        </props>
    </property>
</bean>
```

### 1.5. IOC/DI 配置管理第三方 bean

#### 1.5.1. 案例:数据源对象管理

Druid(德鲁伊) / C3P0

```xml
<!--  
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid</artifactId>
            <version>1.1.16</version>
        </dependency>
-->
<bean class="com.alibaba.druid.pool.DruidDataSource">
    <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
    <property name="url" value="jdbc:mysql://localhost:3306/spring_db"/>
    <property name="username" value="root"/>
    <property name="password" value="123456"/>
</bean>

<!--  
        <dependency>
            <groupId>c3p0</groupId>
            <artifactId>c3p0</artifactId>
            <version>0.9.1.2</version>
        </dependency>
        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
            <version>8.3.0</version>
        </dependency>
-->
<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource">
    <property name="driverClass" value="com.mysql.jdbc.Driver"/>
    <property name="jdbcUrl" value="jdbc:mysql://localhost:3306/spring_db"/>
    <property name="user" value="root"/>
    <property name="password" value="123456"/>
    <property name="maxPoolSize" value="10"/>
</bean>
```

```java
ApplicationContext ctx = new ClassPathXmlApplicationContext("applicationContext.xml");
DataSource dataSource = (DataSource) ctx.getBean("dataSource");
System.out.println(dataSource);
```

#### 1.5.2. 加载 properties 文件

```xml
<!-- 
    开 context 名称空间
-->
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd">

    <!--
        system-properties-mode="NEVER"
            不加载系统环境变量，避免与文件中定义的变量冲突

        location="classpath:jdbc.properties"
            加载当前项目类路径下的 jdbc.properties
        location="classpath:1.properties, 2.properties"
            加载当前项目类路径下的 多个文件
        location="classpath:*.properties"
            加载当前项目类路径下的所有 .properties 文件
        location="classpath*:*.properties"
            加载 当前项目类路径及jar包 中所有 .properties 文件
    -->
    <context:property-placeholder location="classpath:jdbc.properties" system-properties-mode="NEVER"/>
    <bean id="dataSource" class="org.example.MyDataSource">
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="url" value="${jdbc.url}"/>
        <property name="username" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>
</beans>
```

jdbc.properties:

```properties
jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://127.0.0.1:3306/spring_db
jdbc.username=root
jdbc.password=123456
```

```java
public class MyDataSource {
    private String driverClassName;
    private String url;
    private String username;
    private String password;

    public void setDriverClassName(String driverClassName) {
        this.driverClassName = driverClassName;
    }
    public void setUrl(String url) {
        this.url = url;
    }
    public void setUsername(String username) {
        this.username = username;
    }
    public void setPassword(String password) {
        this.password = password;
    }

    public String toString() {
        return "driverClassName=" + driverClassName
                + ", url=" + url
                + ", username=" + username
                + ", password=" + password
        ;
    }
}
```

### 1.6. 核心容器

#### 1.6.1. 容器

容器的创建方式：

```java
// 类路径下的XML配置文件
ApplicationContext ctx = new ClassPathXmlApplicationContext("applicationContext.xml");

// 文件系统下的XML配置文件
ApplicationContext ctx = new FileSystemXmlApplicationContext("D:\\applicationContext.xml");
```

Bean的三种获取方式:

```java
BookDao bookDao = (BookDao) ctx.getBean("bookDao");

BookDao bookDao = ctx.getBean("bookDao"，BookDao.class);

BookDao bookDao = ctx.getBean(BookDao.class);
```

容器类层次结构:

* BeanFactory: 最上级的父接口

### 1.7. IOC/DI 注解开发

#### 1.7.1. 注解开发定义 bean

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd">

    <!-- 扫描 org.example 递归查找该包及子包的类 -->
    <context:component-scan base-package="org.example" />
</beans>
```

```java
@Repository
public class BookDaoImpl implements BookDao { }

@Service("bookService")
public class BookServiceImpl implements BookService { }

public class App {
    public static void main(String[] args) {
        ConfigurableApplicationContext ctx = new ClassPathXmlApplicationContext("applicationContext.xml");

        BookService bookService = (BookService) ctx.getBean("bookService");
        System.out.println(bookService);

        BookDao bookDao = ctx.getBean(BookDao.class);
        System.out.println(bookDao);
    }
}
```

#### 1.7.2. 纯注解开发模式

配置类 替代 配置文件：

```java
@Configuration
@ComponentScan("org.example")
public class SpringConfig {
}
```

加载配置类:

```java
public class AppForSpringConfig {
    public static void main(String[] args) {
        ApplicationContext ctx = new AnnotationConfigApplicationContext(SpringConfig.class);

        BookService bookService = (BookService) ctx.getBean("bookService");
        System.out.println(bookService);

        BookDao bookDao = ctx.getBean(BookDao.class);
        System.out.println(bookDao);
    }
}
```

#### 1.7.3. bean 作用范围与生命周期

```java
@Repository
@Scope("singleton") // "prototype"
public class BookDaoImpl implements BookDao {
    public void save() {
        System.out.println("book dao save ...");
    }

    @PostConstruct // 构造器执行之后
    public void myInit() {
        System.out.println("init ...");
    }

    @PreDestroy // 销毁之前
    public void myDestroy() {
        System.out.println("destroy ...");
    }
}

public class App {
    public static void main(String[] args) {
        AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext(SpringConfig.class);
        System.out.println(ctx.getBean(BookDao.class));
        System.out.println(ctx.getBean(BookDao.class));
        ctx.close();
    }
}
```