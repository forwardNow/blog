# koa2

* koa2 的介绍
* koa2 快速上手
* 后台项目

## 1. 介绍

说明：

* 基于 Node.js 平台的 web 开发框架
* 由 Express 原班人马打造

Web框架比较：

| web框架   | 异步处理              |
|---------|-------------------|
| Express | 回调函数              |
| koa     | Generator + yield |
| koa2    | async / await     |

特点：

* 支持 async/await (node v7.6+)
* 洋葱模型的中间件
  * ![koa2_middleware](../_images/koa2_middleware.png)

## 2. 快速上手

安装：

```shell
npm i koa
```

目录结构：

```text
${root}/
    app.js
```

app.js:

<<< @/codes/koa2/01-quick-start/app.js

访问： 

* http://localhost:3000/

中间件的特点：

* 通过 `koaIns.use()` 应用中间件
* 一个中间件就是一个函数
* 中间件的执行顺序符合洋葱模型
* 需要调用 `next()` 方法才会执行下一个中间件

中间件示例：

<<< @/codes/koa2/01-quick-start/app_onion.js

## 3. 后台项目

目标：

* 计算处理请求的耗时
* 设置 MIME 类型
* 根据 URL 读取文件内容

步骤：

1. 项目准备
2. 总耗时中间件
3. 响应头中间件
4. 业务逻辑中间件
5. 允许跨域

### 3.1. 项目准备

安装依赖：
  
```shell
npm init -y
npm install koa
```
 
文件及目录结构：

```text
${root}/
  app.js
  data/
    seller.json
  middleware/
    koa_response_data.js
    koa_response_duration.js
    koa_response_header.js
  utils/
    file_utils.js
```

创建文件：

```shell
echo '' > app.js

md data

md middleware
echo '' > middleware/koa_response_data.js
echo '' > middleware/koa_response_duration.js
echo '' > middleware/koa_response_header.js

md utils
echo '' > utils/file_utils.js

```
