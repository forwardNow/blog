# 正则表达式必知必会

## 1. 第 1 章 正则表达式入门

用途：

* 解决特定的问题而发明的一种工具

如何使用：

* 搜索
* 替换

什么是正则：

* 正则表达式，regular expression，RegEex，regex，模式
* 正则表达式是一些用来匹配和处理文本的字符串
* 正则表达式语言用来构造正则表达式，正则表达式用来完成搜索和替换操作。

## 2. 第 2 章 匹配单个字符

匹配普通文本：

* `Ben`

匹配多个结果：

* 正则表达式引擎默认返回第一个匹配结果
* JS 中，使用 `g` 来返回所有匹配结果

字母的大小写：

* 正则表达式是区分大小写的
* JS 中，使用 `i` 忽略大小写

匹配任意单个字符：

* `.` 点符号，特殊字符，表示任意单个字符
* `\.` 匹配点符号本身，转义

元字符：

* 有特殊含义的字符
* 如 `.` , `\`

## 3. 第 3 章 匹配一组字符

匹配多个字符中的一个：

* `[abc]`
* 元字符 `[` , `]` 用来定义一个字符集合，必须匹配集合中的字符之一

字符区间：

* `A-Z`: 从大写字符 A 到大写字符 Z
* `a-z`: 从小写字符 a 到小写字符 z
* `A-z`: 这个区间包含 `[` ,`^` 等字符

排除：

* `[^xyz]` 排除字符集合中的所有字符

注意：

* `-` 只有在 `[a-z]` 中才是元字符，在其他地方就是普通字符
* `[\w.]`: `\w` 是元字符，`.` 是普通字符
* `[\/]`: 斜线 `/` 在`[ ]` 中可以不用转义，但有些正则引擎要求转义

## 4. 第 4 章 使用元字符

转义：

* 元字符有特殊含义，无法代表自身
* 通过 `\` 元字符来对元字符进行转义

空白字符：

| 元字符 | 说明 |
| :- | :- |
| \b | 回退（Backspace 键） |
| \f | 换页符 |
| \n | 换行符 |
| \r | 回车符 |
| \t | 制表符（Tab 键） |
| \v | 垂直制表符 |

文本行结束标记：

* `\r\n`: windows 系统
* `\n`: Unix 系统

普通字符转义为元字符：

* `\` 对普通字符使用，可以将普通字符转义为元字符

匹配数字：

* `\d`: 数字，`[0-9]`
* `\D`: 非数字，`[^0-9]`

匹配字母数字下划线：

* `\w`: 字母数字下划线， `[a-zA-Z0-9_]`
* `\W`: 非字母数字下划线， `[^a-zA-Z0-9_]`

匹配空白字符：

* `\s`: 空白字符， `[\f\n\r\t\v]`
* `\S`: 非空白字符， `[^\f\n\r\t\v]`

## 5. 第 5 章 重复匹配

量词：

* `*`: 匹配 0 个或多个
* `+`: 匹配 1 个或多个
* `?`: 匹配 0 个或 1 个

区间范围：

* `{m}`: 匹配 m 个
* `{m, n}`: 匹配至少 m 个，最多 n 个
* `{m,}`: 匹配至少 m 个

贪婪型量词：

* `*` / `+` / `{m,}`
* 没有上限，尽可能多的匹配

懒惰型量词：

* `*?` / `+?` / `{m,}?`
* 尽可能少的匹配，碰到第一个匹配就停止


## 6. 第 6 章 位置匹配

单词边界：

* `\b`: 匹配一个单词的开头或结尾，匹配一个位置，一边是单词(`\w`) 一边是其他内容(`\W`)
* `\bcat\b`: 匹配完整的单词
* `\bcat`: 匹配以 `cat` 打头的单词
* `cat\b`: 匹配以 `cat` 结尾的单词

字符串边界：

* `^a`: 匹配以 `a` 打头的
* `a$`: 匹配以 `a` 结尾的
* 多行模式：`^`,`&` 会作用到每一行

## 7. 第 7 章 使用子表达式

子表达式：

* 元字符： `(` , `)`
* 示例：

    ```text
    (19|20)\d{2}

      |, 是或操作符, 从左到右匹配，匹配第一个就停止
    ```

子表达式嵌套：

* 示例：匹配 IP 地址

    ```text
    分析：
      1. 一位数： 
          
          \d

      2. 两位数：

          \d{2}

      3. 三位数

          1 开头：  1\d{2}
          2 开头：
              第 2 位是 0 ~ 4： 2[0-4]\d
              第 2 被是 5：     25[0-5]

    综上：

      ( ( (25[0-5]) | (2[0-4]\d) | (1\d{2}) | (\d{2}) | (\d) ) \. ){3} ( (25[0-5]) | (2[0-4]\d) | (1\d{2}) | (\d{2}) | (\d) )

      (((25[0-5])|(2[0-4]\d)|(1\d{2})|(\d{2})|(\d))\.){3}((25[0-5])|(2[0-4]\d)|(1\d{2})|(\d{2})|(\d))
    ```

## 8. 第 8 章 反向引用

反向引用匹配：

* 通过 `\n` 引用第 n 个分组（子表达式）匹配的结果
* 在 JS 中，使用 `\n` 标识反向引用，在替换中用 `$n` 标识

* 示例：匹配连续单词

    ```js
    `
    this is a block of of text,
    several words here are are
    repeated, and and they should not be;
    `
    .match(
      /[ ](\w+)[ ]\1/g
    )

    /* =>

    (3) [' of of', ' are are', ' and and']

    */


    /* 
    分析：
      [ ](\w+)[ ]\1

        [ ](\w+)[ ]\w+
        两个 \w+ 要求内容一样
    */
    ```

* 示例：匹配 HTML 中 `<hn>` 标签：

    ```js
    `
    <body>
      <h1>xxx yy zz</h1>
      xxx yy zz
      <h2>xxx yy zz</h2>
      xxx yy zz
      <h5>xxx yy zz</h2>
      xxx yy zz
    </body>
    `
    .match(
      /<h([1-5])>.*?<\/h\1>/gi
    )

    /* =>

    (2) ['<h1>xxx yy zz</h1>', '<h2>xxx yy zz</h2>']

    */
    ```

替换操作：

* 跨模式使用反向引用
* 示例：将邮箱地址替换为可点击的：

    ```js
    `
      hello, forward@qq.com is my email address.
    `
    .replace(
      /(\w+[\w\.]*@[\w\.]+\.\w+)/,
      '<a href="mailto:$1">$1</a>'
    )

    /* =>

    '\n  hello, <a href="mailto:forward@qq.com">forward@qq.com</a> is my email address.\n'

    */
    ```