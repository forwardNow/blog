# 使用 Vue 脚手架

## 1. 初始化脚手架

### 1.1. 说明

Vue 脚手架是 Vue 官方提供的标准化开发工具（开发平台）

最新的版本是 5.x

官网: [https://cli.vuejs.org/zh/](https://cli.vuejs.org/zh/)

### 1.2. 步骤

1.全局安装 @vue/cli ：

```shell
# 设置淘宝镜像源
npm config set registry https://registry.npm.taobao.org

# 全局安装
npm install -g @vue/cli

# 查看版本
vue -V
# @vue/cli 5.0.8
```

2.创建项目：

```shell
# 切换到工作空间

vue create vue-proj
```

3.启动项目：

```shell
npm run serve
```

4.访问 [http://localhost:8080/](http://localhost:8080/)

### 1.3. webpack 配置

Vue 脚手架隐藏了所有 webpack 相关的配置，

若想查看具体的 webpack 配置，请执行：

```shell
vue inspect > webpack-config-output.js
```

### 1.4. 模板项目结构

```text
vue-proj/
  public/
    favicon.ico       # 页签图标
    index.html        # 主页面
  src/
    assets/           # 存放静态资源
      logo.png
    component/        # 存放组件
      HelloWorld.vue
    App.vue           # 汇总所有组件
    main.js           # 入口文件
  .gitignore          # git 版本管制忽略的配置
  babel.config.js     # babel 的配置文件
  package.json        # 应用包配置文件
  README.md           # 应用描述文件
  package-lock.json   # 包版本控制文件
```

`vue-proj/public/index.html`：

```html

<!--  
  BASE_URL: 指向 public 目录
-->

<link rel="icon" href="<%= BASE_URL %>favicon.ico">
```

## 2. Vue 文件说明

### 2.1. 引入 Vue

`vue-proj/main.js` ：

```javascript
// 引入的是哪个文件???
import Vue from 'vue';
```

### 2.2. 引入的是哪个

查看 `node_modules/vue/package.json` :

```json
{
  "name": "vue",
  "version": "2.7.14",

  "main": "dist/vue.runtime.common.js",
  "module": "dist/vue.runtime.esm.js",

  "unpkg": "dist/vue.js",
  "jsdelivr": "dist/vue.js",
}
```

### 2.3. package.json 相关配置

#### 2.3.1. npm 包入口配置

| 配置 | 规范 | 说明|
| - | - | - |
| module | esm | 现代 ECMA 规范，摇树性能好，首推使用 |
| main | cjs | node 使用的 require 规范，无摇树 |
| browser | umd | 支持 cjs、amd、global(window) ，一般用在浏览器中 |

对 webpack 而言，使用的顺序为： `browser` -> `module` -> `main`

#### 2.3.2. CDN 相关配置

| 配置 | 说明 |
| - | - |
| unpkg | npm: `unpkg.com/:package@:version/:file`  |
| jsdelivr | npm: `https://cdn.jsdelivr.net/npm/包名@版本号/目录` <br> github: `https://cdn.jsdelivr.net/gh/用户名称/仓库名称@版本号/目录`  |

### 2.4. vue 文件类型

| 文件名 | 说明 |
| - | - |
| vue.js | 完整版，包含 core(核心) 和 compiler(模板编译器) |
| vue.runtime.js | 运行时版本，只有 core |

| 文件名 | 说明 |
| - | - |
| vue.js | 完整版，UMD 版 |
| vue.common.js | 完整版，CommonJS 版 |
| vue.esm.js | 完整版，ES 版 |

### 2.5. 总结

**开发态：**

用 `vue-template-compiler` 编译 `.vue` 文件

**运行态：**

使用 `vue.runtime.js`

**没有模板编译器：**

* 不能使用 `options.template` 配置项
* 需要使用 `options.render` 配置项来渲染模板


  ```javascript
  import App from './App.vue'
  new Vue({
    render: function(createElement) {
      return createElement(App);
    }
  });
  ```

**使用完整版：**

```javascript
import Vue from 'vue/dist/vue.esm';
```

**package.json 入口配置：**

* 不要使用 `browser`
* 优先使用 `module`
* `module` 和 `main` 同时存在，webpack 优先使用 `module`

### 2.6. 参考

* [package.json配置详解，让你一看就会（上）](https://juejin.cn/post/7027293182249402405)
* [浅谈package.json中main、module、browser字段对webpack的重大影响](https://blog.csdn.net/qq_21567385/article/details/112392354)

## 3. vue.config.js 配置文件

[https://cli.vuejs.org/zh/config/](https://cli.vuejs.org/zh/config/)

`vue inspect > output.js` 可以导出 webpack 配置项

常用配置：

| 配置 | 说明 |
| - | - |
| lintOnSave | 每次保存时 lint 代码，`true` 或 `'warning'` 不会导致编译失败 |
| pages | 多页面配置 |

## 4. ref 属性

作用： 给元素或子组件注册引用

使用：

```html
<template>
  <!-- 普通 HTML 元素 -->
  <div ref='elt'></div>

  <!-- 组件 -->
  <Person ref='cp' />
</template>
<script>
  export default {
    mounted() {
      this.$refs.elt; // 返回 DOM 元素（HTMLElement 的实例）
      this.$refs.cp;  // 返回 vc（VueComponent 的实例，Person 的实例）
    }
  }
</script>
```

## 5. props 属性

功能：让组件接收外部传过来的数据

传数据：（父组件）

```html
<!-- 如果不用 v-bind，则传入的都是字符串 -->
<Demo name="张三" :gender="'男'" :age="18" />
```

接数据：（子组件）

```javascript
// 只接收
options = {
  props: [ 'name', 'gender', 'age' ]
}

// 限制类型
options = {
  props: {
    name: String,
    gender: String,
    age: Number,
  }
}

// 限制类型、限制必要性、指定默认值
options = {
  props: {
    name: { 
      type: String, 
      required: true,
    },
    gender: { 
      type: String 
    },
    age: { 
      type: Number, 
      default: 18 
    },
  }
}
```

备注：

::: v-pre
* props 是只读的，Vue 底层会监测你对 props 的修改，如果进行了修改，就会发出警告
:::
* 如果要修改，则拷贝到 data 中进行修改

  ```javascript
  options = {
    props: [ 'age' ],
    // Vue 先接收 props 再处理 data()，所以 data() 中可以读取到 props
    // 如果 data() 与 props 有属性冲突，则以 props 的优先
    data() {
      return {
        newAge: this.age,
      },
    },
  }
  ```

## 6. mixin(混入)

功能：可以把多个组件共用的配置提取成一个混入对象

定义：


```javascript
export default {
  data(){ return { /* ... */ }; },
  methods:{ /* ... */ },
  created() { /* ... */ },
  mounted() { /* ... */ },
}
```

使用：

```javascript
import myMixin from '...';

// 全局混入，所有的 vc、vm 都有效
Vue.mixin(myMixin);

// 局部混入，当前组件有效
options = {
  mixins: [ myMixin ],
};
```

注意：

* 当配置冲突时，生命周期函数都会执行，非生命周期配置以当前组件优先。

## 7. 插件

功能：用于增强 Vue

本质：

::: v-pre
* 包含 install 方法的一个对象
* install 的第一个参数是 Vue，第二个以后的参数是插件使用者传递的数据。
:::

定义：

```javascript
export default {
  install(Vue, options) {
    // 1. 添加全局过滤器
    Vue.filter(/* .... */)

    // 2. 添加全局指令
    Vue.directive(/* .... */)

    // 3. 配置全局混入(合)
    Vue.mixin(/* .... */)

    // 4. 配置全局组件
    Vue.component(/* ... */);

    // 5. 添加实例方法
    Vue.prototype.$myMethod = function () {/* ... */}
    Vue.prototype.$myProperty = xxxx
  }
};
```

使用：

```javascript
Vue.use(myPlugin);

Vue.use(myPlugin, { prop1: value1, prop2: value2 });
```

## 8. scoped 样式

功能：让样式在局部生效（只在当前组件生效），防止冲突。

使用：

```html
<template>
  <div class="demo">123</div>
</template>
<style scoped>
  .demo { color: red; }
</style>
```

解析后：

```html
<div class="demo" data-v-123456>123</div>
<style>
  .demo[data-v-123456]{ color: red; }
</style>
```

其他：

::: v-pre
* 可以通过 `<style lang="less">` 指定使用 less 语法写样式
:::