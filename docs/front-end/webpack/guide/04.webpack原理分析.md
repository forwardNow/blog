# webpack 原理分析

## 1. loader

### 1.1. 概念

帮助 webpack 将不同类型的文件转换为 webpack 可识别的模块

### 1.2. 分类

| category | desc      |
|----------|-----------|
| pre      | 前置 loader |
| normal   | 普通 loader |
| inline   | 内联 loader |
| post     | 后置 loader |

### 1.3. 执行顺序

说明：

* 相同类别的 loader 执行顺序： 从右到左，从下到上
* 不同类别的 loader 执行顺序： `pre > normal > inline > post`

示例1：

```javascript
// 此时 loader 执行顺序：loader3 - loader2 - loader1
module.exports = {
  module: {
    rules: [
      { test: /\.jsx$/, loader: 'loader1' },
      { test: /\.css$/, loader: 'loader2' },
      { test: /\.jpg$/, loader: 'loader3' },
    ],
  },
};
```

示例2:

```javascript
// 此时 loader 执行顺序：loader1 - loader2 - loader3
module.exports = {
  module: {
    rules: [
      { test: /\.jsx$/, loader: 'loader1', enforce: 'pre' },  // 前置 loader
      { test: /\.css$/, loader: 'loader2' },                  // 普通 loader
      { test: /\.jpg$/, loader: 'loader3', enforce: 'post' }, // 后置 loader
    ],
  },
};
```

### 1.4. 使用方式

* 配置方式，指定 pre、normal、post loader
* 内联方式，指定 inline loader

#### 1.4.1. 配置方式

说明：

* 在 webpack.config.js 中配置 module.rules.Rule 即可

示例：

```javascript
module.exports = {
  module: {
    rules: [
      { 
        test: /\.jsx$/, 
        loader: 'loader1', 
        enforce: 'pre' 
      },
    ],
  },
};
```

#### 1.4.2. 内联方式

说明：

* inline loader （内联 loader）
* 在 `import` 语句中指定用哪些 loader 来处理这个模块，指定的那些 loader 都是 inline loader

示例：

1. `import 'style-loader!css-loader?modules!./styles.css';`

   * 使用 `style-loader`、`css-loader` 处理 `./styles.css` 模块
   * `css-loader?modules` 中的 `?modules` 是 query string（查询字符串）
   * 各个部分（loader、资源路径）之间用 `!` 分隔

2. `import '!style-loader!css-loader?modules!./styles.css';`
    
    * 打头的前缀 `!`，表示跳过 normal loader
    * 也就是说，跳过其它也能处理这个文件的 普通 loader （webpack.config.js 中配置的）

3. `import '-!style-loader!css-loader?modules!./styles.css';`

   * 打头的前缀 `-!`，表示跳过 pre、normal loader

4. `import '!!style-loader!css-loader?modules!./styles.css';`

   * 打头的前缀 `!!`，表示跳过 pre、normal、post loader
