# 基础

[[toc]]

>环境：webpack 5, node.js 16+

## 1. 前言

### 1.1. 为什么需要打包工具？

开发时，我们会使用 框架（React、Vue）、ES6（模块、语法）、CSS 预处理器（Less/Sass）等等 进行开发。

这样的代码要想在浏览器运行，必须将其编译成浏览器能识别的 JS、CSS 文件。

因此我们需要打包工具帮我们做完这些事。

除此之外，打包工具还能压缩代码、做兼容性处理、提升代码性能等。

### 1.2. 有哪些打包工具？

- Grunt
- Gulp
- Parcel
- Webpack
- Rollup
- Vite
- ...

目前市面上最流量的是 Webpack，所以我们主要以 Webpack 来介绍使用打包工具

## 2. 基本使用

**Webpack 是一个静态资源打包工具。**

它会以一个或多个文件作为打包的入口，将我们整个项目所有涉及的文件编译组合成一个或多个文件。

Webpack 输出的文件叫做 bundle，可以在浏览器端运行。

### 2.1. 功能介绍

Webpack 本身功能是有限的:

- 开发模式：只能处理 `ES Module` 
- 生产模式：处理 `ES Module`，压缩 JS 代码

### 2.2. 开始使用

#### 2.2.1. 资源目录

```
webpack_code          # 项目根目录（所有指令必须在这个目录运行）
    └── src           # 项目源码目录
    │   ├── js        # js文件目录
    │   │   ├── subtract.js
    │   │   └── sum.js
    │   └── main.js   # 项目主文件
    └── public
        ├── index.html
```

#### 2.2.2. 创建文件

```js
// subtract.js:
export default function (num1, num2) {
  return num1 - num2;
}


// sum.js:
export default (...nums) => {
  return nums.reduce(
    (prevRes, curr) => (prevRes + curr), 0
  );
};


// main.js:
import sum from "./js/sum";
import subtract from "./js/subtract";

console.log( sum(1, 2, 3) );
console.log( subtract(10, 9) );
```

index.html:

```html
<h1>hello webpack</h1>
<script src="../dist/main.js"></script>
```

#### 2.2.3. 下载依赖

1. 打开终端，来到项目根目录

2. 创建 `package.json` 文件

   * `package.json` 中 `name` 字段不能叫做 `webpack`, 否则会报错

    ```shell
    npm init -y
    ```

3. 安装依赖

    ```
    npm i webpack webpack-cli -D
    ```

    * 安装包及版本：

    ```text
    "webpack": "^5.79.0",
    "webpack-cli": "^5.0.1"
    ```

#### 2.2.4. 启用 Webpack

```shell
## 开发模式:
npx webpack ./src/main.js --mode=development

## 生产模式:
npx webpack ./src/main.js --mode=production
```

说明：

* `npx webpack`: 是用来运行本地安装 webpack 包的。
* `./src/main.js`: 指定 webpack 从 `main.js` 文件开始打包。
* `--mode=development`：指定模式（环境）。

默认 `Webpack` 会将文件打包输出到 `dist` 目录下

### 2.3. 小结

`Webpack` 本身功能比较少，只能处理 `js` 资源，一旦遇到 `css` 等其他资源就会报错。

我们学习 `Webpack`，就是主要学习如何处理其他资源。

## 3. 基本配置

### 3.1. 五大核心概念

| 核心 | 说明 |
| - | - |
| entry（入口） | 指示 Webpack 从哪个文件开始打包 |
| output（输出） | 指示 Webpack 打包完的文件输出到哪里去，如何命名等 |
| loader（加载器） | webpack 本身只能处理 js、json 等资源，其他资源需要借助 loader，Webpack 才能解析 |
| plugins（插件） | 扩展 Webpack 的功能 |
| mode（模式） | 开发模式，development ；生产模式，production |


### 3.2. webpack 配置文件

默认位置： 项目根目录

默认名称： `webpack.config.js`

简单配置：

```js
const path = require("path");

module.exports = {
  // 入口：相对路径和绝对路径都行
  entry: "./src/main.js",

  // 输出
  output: {
    // path: 文件输出目录，必须是绝对路径
    path: path.resolve(__dirname, "dist"),

    // filename: 输出文件名
    filename: "main.js",
  },

  // 加载器
  module: {
    rules: [],
  },

  // 插件
  plugins: [],

  // 模式
  mode: "development", // 开发模式
};
```

运行指令:

```shell
npx webpack
```

## 4. 处理样式资源

> css、less、sass、scss、styl

说明：webpack 不能识别样式文件，需要借助 loader 来解析

参考：[webpack 官方 loader 文档](https://webpack.docschina.org/loaders/)

安装包及版本：

```text
"css-loader": "^6.7.3",
"less-loader": "^11.1.0",
"sass": "^1.62.0",
"sass-loader": "^13.2.2",
"style-loader": "^3.3.2",
"stylus-loader": "^7.1.0",
```

### 4.1. css

安装：

```shell
# 动态创建一个 style 标签，存放 css 代码
npm i -D style-loader

# css-loader: 将 css 文件编译成 webpack 能识别的模块（cjs）
npm i -D css-loader 
```

配置：

```javascript
module: {
  rules: [
    {
      // 匹配 .css 结尾的文件
      test: /\.css$/,
      // loader 执行顺序是从右到左
      use: ["style-loader", "css-loader"],
    },
  ],
},
```

### 4.2. less

安装：

```shell
# 将 less 文件编译成 css 文件
npm i -D less-loader
```

配置：

```javascript
{
  test: /\.less$/,
  use: ["style-loader", "css-loader", "less-loader"],
},
```

### 4.3. sass、scss

安装：

```shell
# sass-loader 依赖 sass
npm i -D sass

# 将 sass 文件编译成 css 文件
npm i -D sass-loader
```

配置：

```javascript
{
  test: /\.s[ac]ss$/,
  use: ["style-loader", "css-loader", "sass-loader"],
},
```

### 4.4. styl

安装：

```shell
# 将 styl 文件编译成 css 文件
npm i -D stylus-loader
```

配置：

```javascript
{
  test: /\.styl$/,
  use: ["style-loader", "css-loader", "stylus-loader"],
}
```