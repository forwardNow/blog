<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2024-04-10 19:31:33
@modify date 2024-04-24 10:42:44
@desc [description]
#endregion-->

# spread.js 快速入门

## 1. 介绍

vue3 项目，使用 spreadjs^16.1.4

## 2. 快速开始

### 2.1. 依赖

```json
{
  "dependencies": {
    "@grapecity/spread-excelio": "^16.1.4",
    "@grapecity/spread-sheets": "^16.1.4",
    "@grapecity/spread-sheets-barcode": "^16.1.4",
    "@grapecity/spread-sheets-charts": "^16.1.4",
    "@grapecity/spread-sheets-designer": "^16.1.4",
    "@grapecity/spread-sheets-designer-resources-cn": "^16.1.4",
    "@grapecity/spread-sheets-designer-resources-en": "^16.1.4",
    "@grapecity/spread-sheets-designer-vue": "^16.1.4",
    "@grapecity/spread-sheets-io": "^16.1.4",
    "@grapecity/spread-sheets-languagepackages": "^16.1.4",
    "@grapecity/spread-sheets-pdf": "^16.1.4",
    "@grapecity/spread-sheets-pivot-addon": "^16.1.4",
    "@grapecity/spread-sheets-print": "^16.1.4",
    "@grapecity/spread-sheets-resources-zh": "^16.1.4",
    "@grapecity/spread-sheets-shapes": "^16.1.4",
    "@grapecity/spread-sheets-tablesheet": "^16.1.4",
    "@grapecity/spread-sheets-vue": "^16.1.4",
  }
}
```

### 2.2. 引入

```vue
<template>
  <div class="lw-online-excel">
    <Designer
      :styleInfo="styleInfo"
      :spreadOptions="spreadOptions"
      @designerInitialized="handleDesignerInitialized">
    </Designer>
  </div>
</template>
<script type="ts">
import { defineComponent } from 'vue';
import lodashGet from 'lodash.get';
import lodashSet from 'lodash.set';

import GC from '@grapecity/spread-sheets';
import '@grapecity/spread-sheets-vue';
import '@grapecity/spread-sheets-designer-resources-en';
import * as ExcelIO from '@grapecity/spread-excelio';
import Designer from '@grapecity/spread-sheets-designer-vue';

import '@grapecity/spread-sheets-designer/styles/gc.spread.sheets.designer.min.css';
import '@grapecity/spread-sheets/styles/gc.spread.sheets.excel2013white.css';

import { SPREAD_JS_LICENSES } from '@/commons/configs/constants';

GC.Spread.Sheets.Designer.LicenseKey = SPREAD_JS_LICENSES.designer;
GC.Spread.Sheets.LicenseKey = SPREAD_JS_LICENSES.sheets;
ExcelIO.LicenseKey = SPREAD_JS_LICENSES.sheets;

export default defineComponent({
  components: {
    Designer,
  },

  data() {
    return {
      styleInfo: { height: '100vh', width: '100vw' },
      spreadOptions: {
        sheetCount: 2,
      },
    };
  },

  methods: {
    // 该方法在 mounted 之前执行
    handleDesignerInitialized(designer: GC.Spread.Sheets.Designer) {
    },
  },
});
</script>
```

## 3. 设计器

### 3.1. 文件菜单

自定义保存的功能

```js
import lodashGet from 'lodash.get';
import lodashSet from 'lodash.set';

import GC from '@grapecity/spread-sheets';

export default {
  methods: {
    handleDesignerInitialized() {
      this.configFileMenu();
    },

    configFileMenu() {
      const that = this;
      const designer = GC.Spread.Sheets.Designer;

      const fileMenuPanelTemplate = designer.getTemplate(designer.TemplateNames.FileMenuPanelTemplate);

      /* {
        "type": "List",
        "listType": "menu",
        "listItemType": "menuitemradio",
        "className": "file-menu-category-list",
        "bindingPath": "activeCategory_main",
        "items": [
          {
            "text": "Open",
            "value": "OpenSJS"
          },
          {
            "text": "Save",
            "value": "SaveSJS"
          }
        ]
      } */
      // console.log(lodashGet(fileMenuPanelTemplate, 'content[0].children[0].children[0].children[0].children[3]'));

      lodashSet(fileMenuPanelTemplate, 'content[0].children[0].children[0].children[0].children[3].items', [
        { text: 'Save', value: 'lw_feature_save' },
      ]);

      designer.registerTemplate(
        designer.TemplateNames.FileMenuPanelTemplate,
        fileMenuPanelTemplate,
      );

      const defaultProcessPropertyChanged = designer.FileMenuHandler.processPropertyChanged;

      designer.FileMenuHandler.processPropertyChanged = function (context, bindingPath, itemValue) {
        console.log({ bindingPath, itemValue });

        if (itemValue === 'lw_feature_save') {
          that.saveFile();
        }

        defaultProcessPropertyChanged.apply(this, arguments);
      };
    },

    saveFile() {
      console.log('saveFile');
    },
  }
};
```

### 3.2. 设置当前选项卡

示例：

```js
/**
 * @param designer {GC.Spread.Sheets.Designer}
 */
handleDesignerInitialized(designer) {
  designer.activeRibbonTab('insert');

  // 查看所有 ribbon（选项卡）配置
  console.log(designer._config.ribbon);
}
```

参考：

* [表格设计器 - 设计器组件 - 定制 - 设定活动选项卡](https://demo.grapecity.com.cn/spreadjs/help/docs/designer/spreadjs_designer_component/customizations/set-active-ribbon)

### 3.3. 导入远程 Excel 文件

```js
function importRemoteExcel() {
  const bits = await axios.get( 'http://localhost:8088/test/1.xlsx', { responseType: 'blob' } );

  const file = new File([bits], '1.xlsx');

  spread.import(
    file,
    () => { console.log('import ok'); },
    (e) => {
      console.log(e);
      throw new Error(JSON.stringify(e));
    },
    { fileType: GC.Spread.Sheets.FileType.excel },
  );
}
```

### 3.4. 自定义 tab

图示：

* ![自定义 tab](./images/01-custom-tab.png)

代码：

```vue
<template>
  <Designer :config="config"> </Designer>
</template>
<script type="ts">
// ...
import Designer from '@grapecity/spread-sheets-designer-vue';

export default defineComponent({
  components: {
    Designer,
  },

  data() {
    const config = GC.Spread.Sheets.Designer.DefaultConfig;

    config.commandMap = {
      EnterESignature: {
        text: 'Enter E-Signature',
        iconClass: 'lw-ribbon-icon-enter-e-signature',
        commandName: 'EnterESignature',
        execute(designer, propertyName, value) {
          console.log('EnterESignature');
        },
      },
    };

    config.ribbon.push({
      id: 'Windsheet',
      text: 'WINDSHEET',
      buttonGroups: [
        {
          label: 'Signoff',
          commandGroup: {
            children: [
              {
                direction: 'vertical',
                commands: [
                  'EnterESignature',
                ],
              },
            ],
          },
        },
      ],
    });

    return {
      config,
    }
  },
});
</script>
```

参考：

* [表格设计器 - 设计器组件 - 定制 - 添加自定义组件](https://demo.grapecity.com.cn/spreadjs/help/docs/designer/spreadjs_designer_component/customizations/add-custom-component)

## 4. 运行时

### 4.1. sheet

#### 4.1.1. 名称

API:

```ts
/**
 * Gets or sets the name of the worksheet.
 * @param {string} [value] The name of the worksheet.
 * @returns {string|GC.Spread.Sheets.Worksheet} If no value is set, returns the worksheet name; otherwise, returns the worksheet.
 * @example
 * ```
 * spread.sheets[0].name("The first sheet");
 * spread.sheets[1].name( "The second sheet");
 * ```
 */
name(value?: string): any;
```

示例：

```js
const spread = designer.getWorkbook();

const sheet = spread.getActiveSheet();

sheet.name(); //=> sheet1
```

#### 4.1.2. 设置列数

```js
sheet.setColumnCount(100); // 当前 sheet 初始设置 100 列
```

### 4.2. event

说明：

* 如果针对是 sheet，则需要在 import 文件之后绑定事件，否则无效

示例：

```vue
<template>
  <Designer @designer-initialized="handleDesignerInitialized"> </Designer>
</template>
<script type="ts">
// ...
import Designer from '@grapecity/spread-sheets-designer-vue';

export default defineComponent({
  components: {
    Designer,
  },

  methods: {
    /**
     * @param designer {GC.Spread.Sheets.Designer}
     */
    handleDesignerInitialized(designer) {
      const spread = designer.getWorkbook();

      const sheet = spread.getActiveSheet();
      
      // 单击单元格
      sheet.bind(GC.Spread.Sheets.Events.CellClick, (sender, args) => {
        console.log('CellClick', args);
      });
      
      // 选择（多个）单元格
      sheet.bind(GC.Spread.Sheets.Events.SelectionChanged, (sender, args) => {
        console.log('SelectionChanged', args);

        // 获取选中的单元格
        console.log(sheet.getSelections());
      });
    },
  },
});
</script>
```

### 4.3. 单元格

#### 4.3.1. 获取单元格

```js
sheet.getCell(1, 1, GC.Spread.Sheets.SheetArea.viewport);
```

#### 4.3.2. 获取单元格集合

```js
// Get range by row and column info
sheet.getRange(1, 1, 10, 10, GC.Spread.Sheets.SheetArea.viewport);

// Or get range by range address
sheet.getRange('A1:A3', GC.Spread.Sheets.SheetArea.viewport);
```

#### 4.3.3. 获取选择的单元格集合

```js
const [selection] = sheet.getSelections();

// {row: 0, rowCount: 2, col: 0, colCount: 2} 
```

#### 4.3.4. 单元格地址转为 Formula

说明：

* 获取选中的单元格（区域），并将其转换为 `$A$1:$B$2` 的格式
* `GC.Spread.Sheets.CalcEngine.rangeToFormula(range: {row: number, rowCount: number, col: number, colCount: number})`

示例：

```js

/**
 * @param designer {GC.Spread.Sheets.Designer}
 */
handleDesignerInitialized(designer) {
  const spread = designer.getWorkbook();

  const sheet = spread.getActiveSheet();

  const [selection] = sheet.getSelections();

  // 将区域转化为公式
  const formula = GC.Spread.Sheets.CalcEngine.rangeToFormula(selection);

  console.log(selection, formula);

  /*  
  选中 A1 - B2 的区域：
  
    {row: 0, rowCount: 2, col: 0, colCount: 2} 
    
    '$A$1:$B$2'
  */
},
```

参考：

* [Convert numbers to letters beyond the 26 character alphabet](https://stackoverflow.com/questions/8240637/convert-numbers-to-letters-beyond-the-26-character-alphabet)

#### 4.3.5. 设置内容

```js
sheet.setValue(6, 0, 'hello');
```

#### 4.3.6. 给单元格设置颜色

示例：

```js
var style = new GC.Spread.Sheets.Style();
style.backColor = 'red';
style.foreColor = 'green';

//set style to cell.
sheet.setStyle(5, 5, style, GC.Spread.Sheets.SheetArea.viewport);

//set style to row.
sheet.setStyle(5, -1, style, GC.Spread.Sheets.SheetArea.viewport);

//set style to column.
sheet.setStyle(-1, 5, style, GC.Spread.Sheets.SheetArea.viewport);

// set style to a range.
sheet.getRange(0, 0, 5, 5).setStyle(style);
sheet.getRange("A1:E5").setStyle(style);
```

参考：

* [https://demo.grapecity.com.cn/spreadjs/SpreadJSTutorial/features/cells/basic-style/purejs](https://demo.grapecity.com.cn/spreadjs/SpreadJSTutorial/features/cells/basic-style/purejs)

#### 4.3.7. 锁定单元格

```js
/**
 * Gets or sets whether the cell is locked. When the sheet is protected, the locked cell cannot be edited.
 * @param {boolean} [value] Set to `true` to lock the cell.
 * @returns {boolean|GC.Spread.Sheets.CellRange} If no value is set, returns whether the cell is locked; otherwise, returns the cell.
 * @example
 * ```
 * activeSheet.getRange(-1, 3, -1, 1, GC.Spread.Sheets.SheetArea.viewport).locked(true);
 * ```
 */
cellRange.locked(value?: boolean): any;
```

#### 4.3.8. 单元格批注

```js
// 设置
sheet.comments.add(5, 5, 'new comment!');

// 移除
sheet.comments.remove(5, 5);

// 获取指定单元格批注
var comment = sheet.comments.get(5, 5);

// 获取所有单元格批注
var comments = sheet.comments.all();
```

参考：

* [https://demo.grapecity.com.cn/spreadjs/SpreadJSTutorial/features/cells/comments/basic-comment/purejs](https://demo.grapecity.com.cn/spreadjs/SpreadJSTutorial/features/cells/comments/basic-comment/purejs)

## 5. 参考

* [spread js 示例](https://demo.grapecity.com.cn/spreadjs/SpreadJSTutorial/)
* [spread js 中文文档](https://demo.grapecity.com.cn/spreadjs/help/docs/overview)
* [spreadjs学习总结（持续更新）](https://huaweicloud.csdn.net/63a562c3b878a54545945e82.html)