<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2024-01-04 10:51:44
@modify date 2024-01-04 19:53:07
@desc [description]
#endregion-->


# socket.io 快速入门

## 1. 介绍

使用 socket.io 的服务端和客户端进行 websocket 通信

## 2. 服务端

安装：

```shell
npm i express socket.io

# "express": "^4.18.2",
# "socket.io": "^4.7.3"
```

示例：

```js
const express = require("express");
const { createServer } = require("http");
const { Server } = require("socket.io");

const app = express();
const httpServer = createServer(app);
const io = new Server(httpServer, { cors: {} });

io.on("connection", (socket) => {
  console.log('server: connected!')

  // 侦听当前 socket 客户端 'SEND' 事件
  socket.on('SEND', (data) => {
    console.log(data);
  });

  // 向所有 socket 客户端 广播消息（不包括当前 socket）
  socket.broadcast.emit('MESSAGE', { message: 'hello, I am server' });

  // 向当前 socket 客户端发送 'MESSAGE' 事件
  socket.emit('MESSAGE', { message: 'hello, I am server' });
});


app.get('/', (req, res) => {
  res.send('hello');
})

httpServer.listen(30001, () => {
  console.log('http://localhost:30001');
});
```

### 2.1. 客户端

安装：

```shell
npm i socket.io-client

# "socket.io-client": "^4.7.3"
```

示例:

```js
import { io } from "socket.io-client";

const socket = io(`ws://localhost:30001`);

// 侦听服务端 'MESSAGE' 事件
socket.on('MESSAGE', (data) => {
  console.log(data);
})

// 向服务端发送 'SEND' 事件
socket.emit('SEND', { message: 'hello, I am client' })
```

## 3. 参考

* [关于socket.io的使用](https://juejin.cn/post/6844903810050031630)
* [https://socket.io/docs/v4/server-initialization/](https://socket.io/docs/v4/server-initialization/)
* [Socket.IO —— 处理 CORS](https://socket.io/zh-CN/docs/v4/handling-cors/#configuration)