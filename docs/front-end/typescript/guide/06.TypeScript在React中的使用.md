# TypeScript 在 React 中的使用

## 1. 使用 CRA 创建支持 TS 的项目

### 1.1. 创建项目

说明：

* React 脚手架工具 `create-react-app`(简称 CRA) 默认支持 TypeScript

示例：

```shell
# "react-ts-basic" 为项目名称
npx create-react-app react-ts-basic --template typescript

# We suggest that you begin by typing:
# 
#   cd react-ts-basic
#   npm start
```

参考：

* [adding-typescript#installation](https://create-react-app.dev/docs/adding-typescript#installation)

### 1.2. 目录结构

与 JS 项目对比，发现：

1. 新增 tsconfig.json 文件
2. 组件的文件扩展名变为 .tsx
3. 新增 react-app-env.d.ts 文件 （React 项目默认的类型声明文件）


### 1.3. react-app-env.d.ts

tsconfig.json 中的 include 配置：

* 指定包含哪些 ts 文件，参考 [tsconfig#include](https://www.typescriptlang.org/tsconfig#include)
* 其中 `.d.ts` 文件会自动加载，无须额外导出和导入

自动导入 `.d.ts` 文件的示例：

```typescript
/* common.d.ts */
type MyCommonType = number;


/* common.d.ts */
let a: MyCommonType = 1;

export default {};
```

同样 `src/react-app-env.d.ts` 文件也会自动加载，其内容为：

```typescript
/// <reference types="react-scripts" />
```

`/// <reference types="react-scripts" />` 为三斜线指令：

* 类似于 import，表示依赖哪个（包的）类型声明文件
* 告诉 TS 加载 react-scripts 这个包提供的类型声明文件

react-scripts 的类型声明文件包含：

1. react、react-dom、node 的类型
2. 图片、样式等模块的类型（允许在 TS 代码中 import 图片、样式等）

## 2. tsconfig.json 配置文件

说明：

* tsconfig.json 文件可以通过 `tsc --init` 命令生成
* tsconfig.json 文件所在目录为项目的根目录
* 官方文档：[https://www.typescriptlang.org/tsconfig](https://www.typescriptlang.org/tsconfig)

顶层属性：

```text
include
compilerOptions

files
extends
exclude
references
```

### 2.1. include

说明：

* Specifies an array of filenames or patterns to include in the program.
* These filenames are resolved relative to the directory containing the tsconfig.json file.

示例：

```json
{
  "include": ["src/**/*", "tests/**/*"]
}
```

### 2.2. compilerOptions

#### 2.2.1. compilerOptions.target

说明：

* 编译后的 JS 代码的版本

可选值:

```text
es3         (default)
es5
es6/es2015
es2016
es2017
es2018
es2019
es2020
es2021
es2022
esnext
```

参考：[https://www.typescriptlang.org/tsconfig#target](https://www.typescriptlang.org/tsconfig#target)

#### 2.2.2. compilerOptions.lib

说明：

* 包含哪些库的类型声明
* 相当于指定代码运行的环境

示例：

```json
{
  "compilerOptions": {
    "lib": [
      "dom",
      "dom.iterable",
      "esnext"
    ]
  }
}
```

参考：[https://www.typescriptlang.org/tsconfig#lib](https://www.typescriptlang.org/tsconfig#lib)

#### 2.2.3. compilerOptions.allowJs

说明：

* 允许在 ts 代码中导入 js 文件
* 推荐开启

参考：[https://www.typescriptlang.org/tsconfig#allowJs](https://www.typescriptlang.org/tsconfig#allowJs)

#### 2.2.4. compilerOptions.skipLibCheck

说明：

* 跳过声明文件的类型检查
* 常用于，当 node_modules 有多份同一个库的类型时
* 推荐开启

参考：[https://www.typescriptlang.org/tsconfig#skipLibCheck](https://www.typescriptlang.org/tsconfig#skipLibCheck)
