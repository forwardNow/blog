# 微信小程序-视图与逻辑

目标：

* 页面之间的导航跳转
* 下拉刷新
* 上拉加载更多
* 常用生命周期函数

目录：

* 页面导航
* 页面事件
* 生命周期
* WXS 脚本

## 1. 页面导航

实现导航的两种方式：

* 声明式导航：使用 `<navigator>` 组件
* 编程式导航：使用导航 API

### 1.1. 声明式导航

导航到 tabBar 页面：

```html
<!--  
  必须指定 url 和 open-type:

    url: 必须以 “/” 打头

    open-type: 值为 "switchTab"
-->
<navigator
  url="/pages/message/message"
  open-type="switchTab"
>
  导航到 tabBar 页面 - 消息页面
</navigator>
```

导航到非 tabBar 页面：

```html
<!--  
    open-type 默认值为 "navigate"
-->
<navigator
  url="/pages/about/about"
  open-type="navigate"
>
  导航到非 tabBar 页面 - 关于页面
</navigator>
```

后退导航：

```html
<!--  
  delta：
    后退几步，默认值为 1
-->
<navigator
  open-type="navigateBack"
  delta="1"
>
  后退一步
</navigator>
```

参考：

* [miniprogram/dev/component/navigator.html](https://developers.weixin.qq.com/miniprogram/dev/component/navigator.html)

### 1.2. 编程式导航

导航到 tabBar 页面：

```javascript
/*  
  参考：https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.switchTab.html
*/
wx.switchTab({
  url: '/pages/message/message',
})
```

导航到非 tabBar 页面：

```javascript
/*  
  参考：https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html
*/
wx.navigateTo({
  url: '/pages/about/about',
});
```

后退导航：

```javascript
/*  
  参考：https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateBack.html
*/
wx.navigateBack({
  delta: 1, // 默认值为 1
});

wx.navigateBack();
```

### 1.3. 导航传参

声明式导航传参：

```html
<!--  
  query 传参    
-->
<navigator
  url="/pages/about/about?namge=zhangsan&age=18"
>
  导航到非 tabBar 页面 - 关于页面，query 传参
</navigator>
```

编程式导航传参：

```javascript
/*  
  query 传参
*/
wx.navigateTo({
  url: '/pages/about/about?name=李四&age=20',
})
```

在 onLoad 中接受导航参数：

```javascript
Page({
  data: {
    query: {},
  },

  /**
   * options 接受 query 传递过来的参数
   */
  onLoad(options) {
    this.setData({
      query: options,
    });
  },
})
```

## 2. 页面事件

### 2.1. 下拉刷新事件

说明：

* 下拉刷新是移动端的专有名词
* 指的是通过手指在屏幕上的下拉滑动操作，从而重新加载页面数据的行为

开启：

* 全局开启： `[app.json].window.enablePullDownRefresh = true`
* 单独开启： `[页面.json].enablePullDownRefresh = true`

样式：

* 文本颜色：`backgroundTextStyle: 'dark' | 'light'` （三个小圆点的颜色）
* 背景颜色：`backgroundColor: HexColor = '#ffffff'`

示例：

```json
// /message/message/message.json
{
    "enablePullDownRefresh": true,
    "backgroundColor": "#efefef",
    "backgroundTextStyle": "dark"
}
```