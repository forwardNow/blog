<!--#region
@author 吴钦飞
@email wuqinfei@qq.com
@create date 2024-04-12 09:05:15
@modify date 2024-05-09 09:56:46
@desc [description]
#endregion-->

# dnd-拖拽改变文件的位置

## 1. 介绍

原理：

1. 侦听元素的 mousedown 事件
2. 一旦 mousedown，则注册 mousemove 和 mouseup 

   * 在 mousemove 里改变元素的位置
   * 在 mouseup 里注销 mousemove 和 mouseup 事件

## 快速开始

## 2. 封装为类

```javascript
class Draggable {
  /** @type {HTMLElement} */
  target = null;

  /** @type {HTMLElement} */
  handle = null;

  /** @type {HTMLElement} */
  container = null;

  options = {
    /**
     * default target
     * @type {HTMLElement | string}
     */
    handle: null,

    /**
     * @type {HTMLElement | string}
     */
    container: document.body,
  };

  /**
   * @param target {HTMLElement | string}
   * @param options {{ handle?: HTMLElement | string, container?: HTMLElement | string }}
   */
  constructor(target, options = {}) {
    this.setTarget(target);
    this.setOptions(options);

    this.setHandle();
    this.setContainer();

    this.setDraggable();
  }

  setTarget(target) {
    this.target = this.getElement(target);
  }

  setOptions(options) {
    this.options = {
      ...this.options,
      ...options,
    };
  }

  setHandle() {
    const { handle } = this.options;

    if (!handle) {
      this.handle = this.target;
      return;
    }

    this.handle = this.getElement(handle);
  }

  setContainer() {
    const { container } = this.options;

    this.container = this.getElement(container);
  }

  getElement(selectorOrElement) {
    if (typeof selectorOrElement === 'string') {
      return document.querySelector(selectorOrElement);
    }

    return selectorOrElement;
  }

  setDraggable() {
    this.handle.addEventListener('mousedown', this.handleMousedown);
  }

  /** @param event {MouseEvent} */
  handleMousedown = (event) => {
    this.container.addEventListener('mousemove', this.handleMousemove);
    this.container.addEventListener('mouseup', this.handleMouseup);

    event.preventDefault();
  }

  handleMouseup = () => {
    this.container.removeEventListener('mousemove', this.handleMousemove);
    this.container.removeEventListener('mouseup', this.handleMouseup);
  }

  /** @param event {MouseEvent} */
  handleMousemove = (event) => {
    const { movementX: offsetX, movementY: offsetY } = event;

    const { x: left, y: top } = this.getTargetPosition();

    this.setTargetPosition(left + offsetX, top + offsetY);

    event.preventDefault();
  }

  setTargetPosition(x, y) {
    this.target.style.left = `${x}px`;
    this.target.style.top = `${y}px`;
  }

  getTargetPosition() {
    const { x, y } = this.target.getBoundingClientRect();
    return { x, y };
  }

  destroy() {
    this.handle.removeEventListener('mousedown', this.handleMousedown);

    this.target = null;
    this.handle = null;
    this.container = null;

    this.options = null;
  }
}

export default Draggable;
```

## 3. 参考

* [How TO - Create a Draggable HTML Element](https://www.w3schools.com/howto/howto_js_draggable.asp)
* [https://stackoverflow.com/questions/60981769/resizable-sidebar-drag-to-resize](https://stackoverflow.com/questions/60981769/resizable-sidebar-drag-to-resize)