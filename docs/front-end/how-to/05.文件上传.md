# 文件上传

## 1. 选择图片转 base64 上传

```html
<button onclick="handleClickButton()">点击上传</button>
<input id="fileInput" type="file" onchange="handleFileInputChange()">

<script>
  const fileInput = document.getElementById("fileInput");

  function handleClickButton() {
    console.log('handleClickButton')
    fileInput.click();
  }

  function handleFileInputChange () {
    const file = fileInput.files[0];

    const reader = new FileReader();

    if (file) {
      reader.readAsDataURL(file);

      reader.onload = function () {
        const base = reader.result;
        console.log(base);
        // data:image/png;base64,xxxx
      }
    }
      
  }
</script>
```

## 2. axios 文件上传

vue2 版本：

```html
<input id="fileInput" type="file" onchange="handleFileInputChange()">

<script>
  const fileInput = document.getElementById("fileInput");

  function upload() {
    const file = fileInput.files[0];    

    const param = new FormData();       

    // 文件
    param.append('file', file)   

    // 数据
    param.append("name", "张三");
    param.append("age", 18);

    const config = {
      headers: {'Content-Type': 'multipart/form-data'}
    }

    axios.post("uploadLogo", param, config);

  }
</script>
```

## 3. 校验图片类型和尺寸

```html
<input id="fileInput" type="file" onchange="handleFileInputChange()">

<script>
  const fileInput = document.getElementById("fileInput");

  function handleChange() {
    if (!validateFileExt()) {
      return;
    }

    if (!validateFileSize(64)) {
      return;
    }
  }

  // 后缀名
  function validateFileExt() {
    const acceptExts = ['.jpg', '.png', '.gif', '.jpeg'];
    const fileName = fileInput.value;
    
    // null | ['.jpg']
    const matches = fileName.match(/\.[a-zA-Z0-9]+$/);

    if (!matches) {
      return false;
    }

    const ext = matches[0];

    return acceptExts.includes(ext);
  }

  // 文件尺寸
  function validateFileSize(maxKilobyte) {
    const file = fileInput.files[0];    
    const fileBytes = file.size; // 单位字节

    return fileBytes <= maxKilobyte * 1024;
  }
</script>
```

## 4. 参考

* [JS_input type=“file“ 选择文件后转base64编码字符串](https://blog.csdn.net/weixin_44599931/article/details/108474028)
* [vue使用Axios上传文件（post请求）](https://zhuanlan.zhihu.com/p/401927014)