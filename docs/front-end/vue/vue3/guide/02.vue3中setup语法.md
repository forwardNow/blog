# vue3 中 setup 语法

## 1. 说明

在 `<script setup>` 中定义的顶级变量都可以直接在模板中使用

## 2. props

```html
<script setup lang="ts">
  import { withDefaults, defineProps } from 'vue';

  export interface Props {
    name?: string,
    hobby?: string[],
  }

  const props = withDefaults(defineProps<Props>(), {
    name: 'light',
    hobby: ['打乒乓球', '打篮球'],
  });
</script>
```

## 3. v-model

### 3.1. 原理

`<input>` 元素使用 `v-model`：

```html
<input v-model="searchText" />

<!-- 等价于 -->
<input
  :value="searchText"
  @input="searchText = $event.target.value"
/>
```

`<CustomInput>` 组件使用 `v-model`:

```html
<CustomInput v-model="searchText" />

<!-- 等价于 -->
<CustomInput
  :modelValue="searchText"
  @update:modelValue="(newValue) => { searchText = newValue; }"
/>
```

`<CustomInput>` 内部实现:

```html
<template>
  <input :value="modelValue" @input="handleInput" />
</template>

<script setup>
defineProps(['modelValue']);

const emit = defineEmits(['update:modelValue']);

const handleInput = ($event) => {
  emit('update:modelValue', $event.target.value)
}
</script>
```

### 3.2. 多个 v-model 绑定

使用：

```html
<CustomInput v-model:name="person.name" v-model:age="person.age" >
```

`<CustomInput>` 内部实现:

```html
<template>
  <div></div>
</template>
<script setup>
  // 属性
  const props = defineProps({
    name: String,
    age: Number
  })

  // 事件
  const emit = defineEmits(['update:name', 'update:age']);

  emit('update:name', '李四');
  emit('update:age', 19);
</script>
```


## 4. router

### 4.1. 定义 router

```ts
import { createRouter, createWebHistory } from 'vue-router';

const router = createRouter({
  history: createWebHistory(),

  scrollBehavior() {
    // 始终滚动到顶部
    return { top: 0 };
  },
  
  routes: [
    // ...
  ],
});

export default router;
```

### 4.2. router 与 route

```html
<script setup>
import { useRouter, useRoute } from 'vue-router'
import { watch } from 'vue'

const router = useRouter()
const route = useRoute()

watch(
  () => route.params.id,
  async (newId) => {
    await fetchUser(newId)
  }
)
</script>
```


### 4.3. 参考

* [vue-router - 组合式API](https://router.vuejs.org/guide/advanced/composition-api.html)

## 5. 参考

* [vue 官方文档](https://cn.vuejs.org/guide/quick-start.html)