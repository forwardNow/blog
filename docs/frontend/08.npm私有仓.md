# NPM 私有仓

## 1. 安装

```shell
node -v
# v16.14.2

npm install -g verdaccio
```

## 2. 配置


```yaml
auth:
  htpasswd:
    file: D:\verdaccio\htpasswd

uplinks:
  npmjs:
    url: https://repo.huaweicloud.com/repository/npm/

packages:
  '@hui/*':
    # scoped packages
    access: $all
    publish: $authenticated
    unpublish: $authenticated

  '**':
    access: $all
    publish: $authenticated
    unpublish: $authenticated
    proxy: npmjs

listen:
  - 0.0.0.0:4873              # listen on all addresses (INADDR_ANY)

max_body_size: 50mb
```

## 3. 运行

```shell
verdaccio --config D:\verdaccio\config.yaml

# warn --- config file  - D:\verdaccio\config.yaml
# warn --- Plugin successfully loaded: verdaccio-htpasswd
# warn --- Plugin successfully loaded: verdaccio-audit
# warn --- http address - http://0.0.0.0:4873/ - verdaccio/5.9.0
```

## 4. 项目配置

### 4.1. 私仓镜像源

.npmrc 

```text
# 以 @hui 打头的都会请求以下地址
@hui:registry=http://192.168.1.155:4873/

registry=https://repo.huaweicloud.com/repository/npm/
```

### 4.2. 过滤

.npmignore :

```text
.idea

node_modules
```

如果没有 `.npmignore`，则使用 `.gitignore`

### 4.3. 发布地址

.package.json :

```json
{
  "publishConfig": {
    "registry": "http://192.168.1.155:4873"
  }
}
```

## 5. 新增用户及发布

```shell
npm adduser --registry http://192.168.1.155:4873/

# Username: wuqinfei
# Password: 123456
# Email: (this IS public) wuqinfei@qq.com

npm publish
```

## 6. 开机启动

* start_verdaccio.bat

  ```shell
  verdaccio
  ```

* start_verdaccio.vbs

  ```vb
  set ws=WScript.CreateObject("WScript.Shell") 
  ws.Run "cmd.exe /k D:\verdaccio\start_verdaccio.bat"
  ```


## 7. 参考

* [官网 https://verdaccio.org/](https://verdaccio.org/)
* [如何把.bat文件设置为开机自动启动？](https://blog.csdn.net/qq_25430563/article/details/108283328)
* [vbs编程-执行cmd命令](https://blog.csdn.net/WLL1017065322/article/details/123600459)