(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{543:function(a,t,s){"use strict";s.r(t);var e=s(14),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"使用verdaccio搭建npm私有仓"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用verdaccio搭建npm私有仓"}},[a._v("#")]),a._v(" 使用verdaccio搭建npm私有仓")]),a._v(" "),t("h2",{attrs:{id:"_1-环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境"}},[a._v("#")]),a._v(" 1. 环境")]),a._v(" "),t("p",[a._v("Windows 10 专业版")]),a._v(" "),t("p",[a._v("node:")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("node")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# v16.14.2")]),a._v("\n")])])]),t("h2",{attrs:{id:"_2-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装"}},[a._v("#")]),a._v(" 2. 安装")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),a._v(" verdaccio\n")])])]),t("h2",{attrs:{id:"_3-目录结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-目录结构"}},[a._v("#")]),a._v(" 3. 目录结构")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("/D/verdaccio/\n    storage/\n    config.yaml\n    htpasswd\n    readme.md\n    start_verdaccio.bat\n    start_verdaccio.vbs\n")])])]),t("h2",{attrs:{id:"_4-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置"}},[a._v("#")]),a._v(" 4. 配置")]),a._v(" "),t("p",[t("code",[a._v("D:\\verdaccio\\config.yaml")]),a._v(": (以下不是全部配置)")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("auth")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("htpasswd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" D"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\\verdaccio\\htpasswd\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("uplinks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("npmjs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//repo.huaweicloud.com/repository/npm/\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("packages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("'@hui/*'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# scoped packages")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("access")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $all\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("publish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("unpublish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("'**'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("access")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $all\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("publish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("unpublish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" $authenticated\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("proxy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" npmjs\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 0.0.0.0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4873")]),a._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# listen on all addresses (INADDR_ANY)")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("max_body_size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 50mb\n")])])]),t("h2",{attrs:{id:"_5-运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-运行"}},[a._v("#")]),a._v(" 5. 运行")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("verdaccio "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config")]),a._v(" D:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("verdaccio"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("config.yaml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# warn --- config file  - D:\\verdaccio\\config.yaml")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# warn --- Plugin successfully loaded: verdaccio-htpasswd")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# warn --- Plugin successfully loaded: verdaccio-audit")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# warn --- http address - http://0.0.0.0:4873/ - verdaccio/5.9.0")]),a._v("\n")])])]),t("h2",{attrs:{id:"_6-发布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-发布"}},[a._v("#")]),a._v(" 6. 发布")]),a._v(" "),t("p",[t("code",[a._v("${root}")]),a._v(" 代表项目根目录")]),a._v(" "),t("h3",{attrs:{id:"_6-1-私仓源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-私仓源"}},[a._v("#")]),a._v(" 6.1. 私仓源")]),a._v(" "),t("p",[t("code",[a._v("${root}/.npmrc")]),a._v(" :")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 以 @hui 打头的都会请求以下地址\n@hui:registry=http://192.168.1.155:4873/\n\nregistry=https://repo.huaweicloud.com/repository/npm/\n")])])]),t("p",[a._v("在安装依赖时，如果是 "),t("code",[a._v("@hui")]),a._v(" 打头的包名 则会使用对应的地址")]),a._v(" "),t("h3",{attrs:{id:"_6-2-过滤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-过滤"}},[a._v("#")]),a._v(" 6.2. 过滤")]),a._v(" "),t("p",[t("code",[a._v("${root}/.npmignore")]),a._v(" :")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(".idea\n\nnode_modules\n")])])]),t("p",[a._v("选择不发布哪些文件/目录，配置规则与 "),t("code",[a._v(".gitignore")]),a._v(" 一样。")]),a._v(" "),t("p",[a._v("如果没有 "),t("code",[a._v(".npmignore")]),a._v(" 文件，则会使用 "),t("code",[a._v(".gitignore")]),a._v(" 文件。")]),a._v(" "),t("h3",{attrs:{id:"_6-3-发布地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-发布地址"}},[a._v("#")]),a._v(" 6.3. 发布地址")]),a._v(" "),t("p",[t("code",[a._v("${root}/package.json")]),a._v(" :")]),a._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"publishConfig"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[a._v('"registry"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://192.168.1.155:4873"')]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[t("code",[a._v("npm publish")]),a._v(" 时会用到。")]),a._v(" "),t("h3",{attrs:{id:"_6-4-版本管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-版本管理"}},[a._v("#")]),a._v(" 6.4. 版本管理")]),a._v(" "),t("p",[a._v("版本号格式：")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{\n  "version": "major.minor.patch"      // "2.16.8"\n  \n  "version": "主版本号.次版本号.修订号" // "2.16.8"\n}\n')])])]),t("p",[a._v("升级版本号：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 升级主版本号")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" version major\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 升级次版本号")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" version minor\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 升级修订号")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" version patch\n")])])]),t("h3",{attrs:{id:"_6-5-执行发布"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-执行发布"}},[a._v("#")]),a._v(" 6.5. 执行发布")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" adduser "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--registry")]),a._v(" http://192.168.1.155:4873/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Username: wuqinfei")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Password: 123456")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Email: (this IS public) wuqinfei@qq.com")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" publish\n")])])]),t("p",[a._v("执行 "),t("code",[a._v("npm publish")]),a._v(" 时，如果没有设置用户，\n则要求执行 "),t("code",[a._v("npm adduser --registry http://192.168.1.155:4873/")]),a._v(" 来添加用户")]),a._v(" "),t("h2",{attrs:{id:"_7-开机启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-开机启动"}},[a._v("#")]),a._v(" 7. 开机启动")]),a._v(" "),t("ul",[t("li",[t("p",[t("code",[a._v("D:\\verdaccio\\start_verdaccio.bat")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("verdaccio "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config")]),a._v(" D:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("verdaccio"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("config.yaml\n")])])])]),a._v(" "),t("li",[t("p",[t("code",[a._v("D:\\verdaccio\\start_verdaccio.vbs")])]),a._v(" "),t("div",{staticClass:"language-vb extra-class"},[t("pre",{pre:!0,attrs:{class:"language-vb"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),a._v(" ws"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("WScript"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("CreateObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"WScript.Shell"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \nws"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Run "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"cmd.exe /k D:\\verdaccio\\start_verdaccio.bat"')]),a._v("\n")])])])])]),a._v(" "),t("p",[a._v("把 "),t("code",[a._v("D:\\verdaccio\\start_verdaccio.bat")]),a._v("\n放到 "),t("code",[a._v("C:\\Users\\${user}\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup")])]),a._v(" "),t("p",[a._v("打开电脑，登录账号（"),t("code",[a._v("${user}")]),a._v("）后才会执行 “Startup” 目录中的程序。")]),a._v(" "),t("p",[a._v("如果想一打开电脑就让 BAT 执行，则可以将其做成 windows 服务。")]),a._v(" "),t("h2",{attrs:{id:"_8-配置成-windows-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-配置成-windows-服务"}},[a._v("#")]),a._v(" 8. 配置成 windows 服务")]),a._v(" "),t("p",[a._v("管理员权限启动 CMD。")]),a._v(" "),t("p",[a._v("新增服务（"),t("code",[a._v("verdaccio")]),a._v("）：")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("C:\\Windows\\system32> D:\\verdaccio\\bin\\instsrv.exe verdaccio D:\\verdaccio\\bin\\srvany.exe\n\nThe service was successfuly added!\n\nMake sure that you go into the Control Panel and use\nthe Services applet to change the Account Name and\nPassword that this newly installed service will use\nfor its Security Context.\n")])])]),t("p",[a._v("设置服务参数：")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('reg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\verdaccio\\Parameters /v AppDirectory /d "D:\\verdaccio" /t reg_sz /f\nreg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\verdaccio\\Parameters /v Application /d "D:\\verdaccio\\start_verdaccio.bat" /t reg_sz /f\n')])])]),t("p",[a._v("查看服务：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("win + R")]),a._v(" 运行 "),t("code",[a._v("services.msc")])])]),a._v(" "),t("h2",{attrs:{id:"_9-参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-参考"}},[a._v("#")]),a._v(" 9. 参考")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://verdaccio.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("官网 https://verdaccio.org/"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/qq_25430563/article/details/108283328",target:"_blank",rel:"noopener noreferrer"}},[a._v("如何把.bat文件设置为开机自动启动？"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/WLL1017065322/article/details/123600459",target:"_blank",rel:"noopener noreferrer"}},[a._v("vbs编程-执行cmd命令"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/MAOZEXIJR/article/details/84546539",target:"_blank",rel:"noopener noreferrer"}},[a._v("把批处理（bat）做成Windows服务（Server）"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/weixin_44051608/article/details/109532922",target:"_blank",rel:"noopener noreferrer"}},[a._v("使用instsrv.exe+srvany.exe将应用程序安装为windows服务的方法 （包含下载链接）"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);